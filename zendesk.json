{"processDefinition":{"name":"zendesk","steps":[{"type":"Zendesk","name":"get_tickets","properties":{"url":"/api/v2/incremental/tickets.json","params":{"start_time":"@{epoch(extractor.lastExecution != null ? extractor.lastExecution.minusDays(1) : now().minusMonths(24))/1000}","include":"metric_sets,dates,sharing_agreements,comment_count,incident_counts"}},"outputs":[{"name":"success","destination":"clean_tickets","condition":null}],"itemAttributes":{"ticketIds":"@{evalJson(item, '$.tickets[*].id')}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_tickets","properties":{"tables":["Tickets","TicketTags"],"predicates":[{"field":"id","operator":"in","value":"@{item.attributes.ticketIds}"}]},"outputs":[{"name":"success","destination":"clean_ticket_metrics","condition":null}],"itemAttributes":{"users":"@{evalJson(item, '$.users')}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_ticket_metrics","properties":{"tables":["TicketMetrics","TicketSlas"],"predicates":[{"field":"ticketId","operator":"in","value":"@{item.attributes.ticketIds}"}]},"outputs":[{"name":"success","destination":"split_tickets","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_tables","properties":{"tables":["Users","Groups","Organizations","Brands","DeletedTickets"]},"outputs":[{"name":"success","destination":"get_users","condition":null},{"name":"success","destination":"get_groups","condition":null},{"name":"success","destination":"get_organizations","condition":null},{"name":"success","destination":"get_satisfaction_ratings","condition":null},{"name":"success","destination":"get_tickets_full","condition":"@{extractor.isFullExtraction()}"},{"name":"success","destination":"clean_audits_after_last_execution","condition":null},{"name":"success","destination":"get_brands","condition":null},{"name":"success","destination":"get_deleted_tickets","condition":null},{"name":"success","destination":"get_metric_events","condition":null},{"name":"success","destination":"get_custom_fields","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"Zendesk","name":"get_custom_fields","properties":{"url":"/api/v2/ticket_fields.json","params":{}},"outputs":[{"name":"success","destination":"get_tickets","condition":null}],"itemAttributes":{"customFieldsJson":"@{item.content}"},"extendsStep":null},{"type":"Zendesk","name":"get_metric_events","properties":{"url":"/api/v2/incremental/ticket_metric_events.json","params":{"start_time":"@{epoch(extractor.lastExecution != null ? extractor.lastExecution.minusDays(1) : now().minusMonths(24))/1000}"}},"outputs":[{"name":"success","destination":"clean_metric_events","condition":null}],"itemAttributes":{"eventIds":"@{evalJson(item, '$.ticket_metric_events[*].id')}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_metric_events","properties":{"tables":["MetricEvents"],"predicates":[{"field":"id","operator":"in","value":"@{item.attributes.eventIds}"}]},"outputs":[{"name":"success","destination":"split_metric_events","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_metric_events","properties":{"array":"@{evalJson(item, '$.ticket_metric_events')}"},"outputs":[{"name":"success","destination":"map_metric_events","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_metric_events","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","instance_id":"@{evalJson(item, '$.instance_id')}","metric":"@{evalJson(item, '$.metric')}","ticket_id":"@{evalJson(item, '$.ticket_id')}","type":"@{evalJson(item, '$.type')}","sla_business_hours":"@{evalJson(item, '$.sla.business_hours')}","sla_target":"@{evalJson(item, '$.sla.target')}","sla_policy_id":"@{evalJson(item, '$.sla.policy.id')}","sla_policy_title":"@{evalJson(item, '$.sla.policy.title')}","status_calendar_hours":"@{evalJson(item, '$.status.calendar')}","status_business_hours":"@{evalJson(item, '$.status.business')}","deleted":"@{evalJson(item, '$.deleted')}","time":"@{toDateTime(evalJson(item, '$.time'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"}},"outputs":[{"name":"success","destination":"save_metric_events","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_metric_events","properties":{"tableName":"MetricEvents","batchSize":1000,"fields":["id","instance_id","metric","ticket_id","type","sla_business_hours","sla_target","sla_policy_id","sla_policy_title","status_calendar_hours","status_business_hours","deleted","time"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"Zendesk","name":"get_deleted_tickets","properties":{"url":"/api/v2/deleted_tickets.json","params":{}},"outputs":[{"name":"success","destination":"split_deleted_tickets","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_deleted_tickets","properties":{"array":"@{evalJson(item, '$.deleted_tickets')}"},"outputs":[{"name":"success","destination":"map_deleted_tickets","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"JsonToMap","name":"map_deleted_tickets","properties":{"mappings":{"actorId":"@{evalJson(item, '$.actor.id')}","deletedAt":"@{toDateTime(evalJson(item, '$.deleted_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"},"excludes":["deleted_at","actor"]},"outputs":[{"name":"success","destination":"save_deleted_tickets","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_deleted_tickets","properties":{"tableName":"DeletedTickets","batchSize":200,"fields":["id","actorId","previous_state","subject","description","deletedAt"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"Zendesk","name":"get_brands","properties":{"url":"/api/v2/brands.json","params":{}},"outputs":[{"name":"success","destination":"split_brands","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_brands","properties":{"array":"@{evalJson(item, '$.brands')}"},"outputs":[{"name":"success","destination":"map_brands","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"JsonToMap","name":"map_brands","properties":{"mappings":{"logo":"@{evalJson(item, '$.logo.content_url')}","createdAt":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updatedAt":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"},"excludes":["ticket_form_ids","updated_at","created_at"]},"outputs":[{"name":"success","destination":"save_brands","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_brands","properties":{"tableName":"Brands","batchSize":200,"fields":["id","name","logo","active","createdAt","help_center_state","url","brand_url","has_help_center","default","is_deleted","updatedAt","signature_template","subdomain","host_mapping"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_audits_after_last_execution","properties":{"tableName":"AuditEvents","predicates":[{"field":"createdAt","operator":">=","value":"@{extractor.lastExecution != null ? extractor.lastExecution.minusHours(1) : now().minusYears(1)}"}]},"outputs":[{"name":"success","destination":"select_last_audit_token","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"DbFunction","name":"select_last_audit_token","properties":{"field":"auditId","function":"max","tableName":"AuditEvents"},"outputs":[{"name":"success","destination":"get_ticket_events","condition":null}],"itemAttributes":{"maxAuditId":"@{(!itemIsNull) && item.content != null ? item.content : 0}"},"extendsStep":null},{"type":"Zendesk","name":"get_ticket_events","properties":{"url":"/api/v2/ticket_audits.json","params":{},"stopPagination":"@{!itemIsNull && item.attributes.?maxAuditId > 0 && evalJson(response, '$.audits[*].id', []).contains(item.attributes.maxAuditId)}"},"outputs":[{"name":"success","destination":"clean_audit_events","condition":null}],"itemAttributes":{"customFieldIds":"@{evalJson(credentials.config.properties,'$.customFields[*].id')}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_audit_events","properties":{"tableName":"AuditEvents","predicates":[{"field":"auditId","operator":"in","value":"@{evalJson(item, '$.audits[*].id')}"}]},"outputs":[{"name":"success","destination":"split_audits","condition":null}],"itemAttributes":{"eventAuthorId":"@{evalJson(item, '$.author_id')}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_audits","properties":{"array":"@{evalJson(item, '$.audits')}"},"outputs":[{"name":"success","destination":"splite_audit_events","condition":null}],"itemAttributes":{"auditId":"@{evalJson(item, '$.id')}","auditCreatedAt":"@{evalJson(item, '$.created_at')}","ticketId":"@{evalJson(item, '$.ticket_id')}","authorId":"@{evalJson(item, '$.author_id')}","location":"@{evalJson(item, '$.metadata.system.location')}","latitude":"@{evalJson(item, '$.metadata.system.latitude')}","longitude":"@{evalJson(item, '$.metadata.system.longitude')}","client":"@{evalJson(item, '$.metadata.system.client')}"},"extendsStep":null},{"type":"SplitJsonArray","name":"splite_audit_events","properties":{"array":"@{evalJson(item, '$.events[?(@.type == \\'Comment\\' || @.type == \\'Change\\' || @.type == \\'Create\\' || @.type == \\'CommentRedactionEvent\\' || @.type == \\'AttachmentRedactionEvent\\' || @.type == \\'CommentPrivacyChange\\')]')}"},"outputs":[{"name":"success","destination":"map_audit_events","condition":null}],"itemAttributes":{"eventAuthorId":"@{evalJson(item, '$.author_id')}","fieldName":"@{evalJson(item, '$.field_name')}","previousValue":"@{evalJson(item, '$.previous_value')}","value":"@{evalJson(item, '$.value')}"},"extendsStep":null},{"type":"ToMap","name":"map_audit_events","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","type":"@{evalJson(item, '$.type')}","comment":"@{evalJson(item, '$.body')}","isPublic":"@{evalJson(item, '$.public')}","previousValue":"@{item.attributes.?value != null && (item.attributes.value instanceof Number || item.attributes.value instanceof String) ? item.attributes.?previousValue : null}","value":"@{item.attributes.?value != null && (item.attributes.value instanceof Number || item.attributes.value instanceof String) ? item.attributes.value : null}","changeFieldName":"@{item.attributes.?fieldName != null ? (item.attributes.?customFieldIds != null && item.attributes.?customFieldIds.contains(toLongIfPossible(item.attributes.fieldName,0L))) ? listItem(evalJson(credentials.config.properties,'$.customFields[?(!@.id == \\''+ item.attributes.fieldName + '\\')].title'),0): item.attributes.?fieldName : null}","auditId":"@{item.attributes.auditId}","ticketId":"@{item.attributes.ticketId}","authorId":"@{item.attributes.?eventAuthorId != null ? item.attributes.?eventAuthorId : item.attributes.authorId}","createdAt":"@{toDateTime(item.attributes.auditCreatedAt, 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","location":"@{item.attributes.?location}","latitude":"@{item.attributes.?latitude}","longitude":"@{item.attributes.?longitude}","client":"@{item.attributes.?client}"}},"outputs":[{"name":"success","destination":"save_audit_events","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_audit_events","properties":{"tableName":"AuditEvents","batchSize":1000,"fields":["id","ticketId","authorId","auditId","createdAt","type","comment","isPublic","changeFieldName","value","previousValue","location","latitude","longitude","client"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"Zendesk","name":"get_tickets_full","properties":{"url":"/api/v2/tickets.json","params":{"include":"metric_sets,dates,sharing_agreements,comment_count,incident_counts"}},"outputs":[{"name":"success","destination":"clean_tickets","condition":null}],"itemAttributes":{"ticketIds":"@{evalJson(item, '$.tickets[*].id')}"},"extendsStep":null},{"type":"Zendesk","name":"get_satisfaction_ratings","properties":{"url":"/api/v2/satisfaction_ratings.json","params":{"start_time":"@{extractor.lastExecution != null ? epoch( extractor.lastExecution.minusDays(1))/1000 : null}"}},"outputs":[{"name":"success","destination":"clean_ratings","condition":null}],"itemAttributes":{"ratingIds":"@{evalJson(item, '$.satisfaction_ratings[*].id')}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_ratings","properties":{"tables":["SatisfactionRatings"],"predicates":[{"field":"id","operator":"in","value":"@{item.attributes.ratingIds}"}]},"outputs":[{"name":"success","destination":"split_ratings","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_ratings","properties":{"array":"@{evalJson(item, '$.satisfaction_ratings')}"},"outputs":[{"name":"success","destination":"map_ratings","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_ratings","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","assigneeId":"@{evalJson(item, '$.assignee_id')}","groupId":"@{evalJson(item, '$.group_id')}","requesterId":"@{evalJson(item, '$.requester_id')}","ticketId":"@{evalJson(item, '$.ticket_id')}","score":"@{evalJson(item, '$.score')}","comment":"@{evalJson(item, '$.comment')}","updatedAt":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","createdAt":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"}},"outputs":[{"name":"success","destination":"save_ratings","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_ratings","properties":{"tableName":"SatisfactionRatings","batchSize":400,"fields":["id","createdAt","updatedAt","score","groupId","comment","ticketId","assigneeId","requesterId"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"Zendesk","name":"get_organizations","properties":{"url":"/api/v2/organizations.json","params":{}},"outputs":[{"name":"success","destination":"split_organizations","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"Zendesk","name":"get_groups","properties":{"url":"/api/v2/groups.json","params":{}},"outputs":[{"name":"success","destination":"split_groups","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"Zendesk","name":"get_users","properties":{"url":"/api/v2/users.json","params":{}},"outputs":[{"name":"success","destination":"split_users","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_groups","properties":{"array":"@{evalJson(item, '$.groups')}"},"outputs":[{"name":"success","destination":"map_groups","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"JsonToMap","name":"map_groups","properties":{"mappings":{"createdAt":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updatedAt":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"},"excludes":["created_at","updated_at"]},"outputs":[{"name":"success","destination":"save_groups","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_groups","properties":{"tableName":"Groups","batchSize":200,"fields":["id","name","url","deleted","createdAt","updatedAt"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_organizations","properties":{"array":"@{evalJson(item, '$.organizations')}"},"outputs":[{"name":"success","destination":"map_organizations","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_organizations","properties":{"mappings":{"name":"@{evalJson(item, '$.name')}","id":"@{evalJson(item, '$.id')}","sharedTickets":"@{evalJson(item, '$.shared_tickets')}","url":"@{evalJson(item, '$.url')}","groupId":"@{evalJson(item, '$.group_id')}","createdAt":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updatedAt":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"}},"outputs":[{"name":"success","destination":"save_organizations","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_organizations","properties":{"tableName":"Organizations","batchSize":200,"fields":["id","name","groupId","url","sharedTickets","createdAt","updatedAt"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_users","properties":{"array":"@{evalJson(item, '$.users')}"},"outputs":[{"name":"success","destination":"map_users","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_users","properties":{"mappings":{"name":"@{evalJson(item, '$.name')}","id":"@{evalJson(item, '$.id')}","email":"@{evalJson(item, '$.email')}","timezone":"@{evalJson(item, '$.time_zone')}","locale":"@{evalJson(item, '$.locale')}","shared":"@{evalJson(item, '$.shared')}","role":"@{evalJson(item, '$.role')}","restrictedAgent":"@{evalJson(item, '$.restricted_agent')}","verified":"@{evalJson(item, '$.verified')}","suspended":"@{evalJson(item, '$.suspended')}","active":"@{evalJson(item, '$.active')}","organizationId":"@{evalJson(item, '$.organization_id')}","chatOnly":"@{evalJson(item, '$.chat_only')}","lastLoginAt":"@{toDateTime(evalJson(item, '$.last_login_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","createdAt":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"}},"outputs":[{"name":"success","destination":"save_users","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_users","properties":{"tableName":"Users","batchSize":200,"fields":["name","id","email","timezone","locale","shared","role","restrictedAgent","verified","suspended","active","organizationId","chatOnly","lastLoginAt","createdAt"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_tickets","properties":{"array":"@{evalJson(item, '$.tickets')}"},"outputs":[{"name":"success","destination":"map_ticket_metrics","condition":null},{"name":"success","destination":"put_custom_fields","condition":null},{"name":"success","destination":"split_slas","condition":null},{"name":"success","destination":"split_tags","condition":null}],"itemAttributes":{"ticketId":"@{evalJson(item, '$.id')}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_tags","properties":{"array":"@{evalJson(item, '$.tags')}"},"outputs":[{"name":"success","destination":"map_tags","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_tags","properties":{"mappings":{"id":"@{item.attributes.ticketId}","tag":"@{item.content}"}},"outputs":[{"name":"success","destination":"save_tags","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_tags","properties":{"tableName":"TicketTags","batchSize":1000,"fields":["id","tag"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_slas","properties":{"array":"@{evalJson(item, '$.slas.policy_metrics')}"},"outputs":[{"name":"success","destination":"map_sla","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_sla","properties":{"mappings":{"ticketId":"@{item.attributes.ticketId}","metric":"@{evalJson(item, '$.metric')}","stage":"@{evalJson(item, '$.stage')}","breachAt":"@{toDateTime(evalJson(item, '$.breach_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","days":"@{evalJson(item, '$.days')}","sla_status":"@{evalJson(item, '$.stage') + (evalJson(item, '$.breach_at') != null ? '_breached' : '')}"}},"outputs":[{"name":"success","destination":"save_slas","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_slas","properties":{"tableName":"TicketSlas","batchSize":200,"fields":["ticketId","metric","stage","sla_status","breachAt","days"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"PutArrayInJson","name":"put_custom_fields","properties":{"array":"@{evalJson(item, '$.custom_fields')}","keyExpression":"@{listItem(evalJson(credentials.config.properties,'$.customFields[?(!@.id == \\''+ arrayItem.id + '\\')].title'),0)}","valueExpression":"@{isBlankString(arrayItem.value) ? null : isCollection(arrayItem.value)? joinToString(arrayItem.value, '_') : listItem(evalJson(item.attributes.customFieldsJson, '$.ticket_fields[?(!@.id == \\''+ arrayItem.id + '\\')].type'),0) == 'date' ?  formatDate(toDateRelaxException(arrayItem.value, 'yyyy-MM-dd'), 'yyyy-MM-dd') : arrayItem.value }"},"outputs":[{"name":"success","destination":"map_ticket","condition":null}],"itemAttributes":{"customFieldsJson":"@{item.content}"},"extendsStep":null},{"type":"ToMap","name":"map_ticket_metrics","properties":{"mappings":{"ticketId":"@{evalJson(item, '$.id')}","groupStations":"@{evalJson(item, '$.metric_set.group_stations')}","assigneeStations":"@{evalJson(item, '$.metric_set.assignee_stations')}","reopens":"@{evalJson(item, '$.metric_set.reopens')}","replies":"@{evalJson(item, '$.metric_set.replies')}","onHoldTimeInMinutesBusiness":"@{evalJson(item, '$.metric_set.on_hold_time_in_minutes.business')}","onHoldTimeInMinutesCalendar":"@{evalJson(item, '$.metric_set.on_hold_time_in_minutes.calendar')}","replyTimeInMinutesBusiness":"@{evalJson(item, '$.metric_set.reply_time_in_minutes.business')}","replyTimeInMinutesCalendar":"@{evalJson(item, '$.metric_set.reply_time_in_minutes.calendar')}","fullResolutionTimeInMinutesBusiness":"@{evalJson(item, '$.metric_set.full_resolution_time_in_minutes.business')}","fullResolutionTimeInMinutesCalendar":"@{evalJson(item, '$.metric_set.full_resolution_time_in_minutes.calendar')}","agentWaitTimeInMinutesBusiness":"@{evalJson(item, '$.metric_set.agent_wait_time_in_minutes.business')}","agentWaitTimeInMinutesCalendar":"@{evalJson(item, '$.metric_set.agent_wait_time_in_minutes.calendar')}","requesterWaitTimeInMinutesBusiness":"@{evalJson(item, '$.metric_set.requester_wait_time_in_minutes.business')}","requesterWaitTimeInMinutesCalendar":"@{evalJson(item, '$.metric_set.requester_wait_time_in_minutes.calendar')}","firstResolutionTimeInMinutesBusiness":"@{evalJson(item, '$.metric_set.first_resolution_time_in_minutes.business')}","firstResolutionTimeInMinutesCalendar":"@{evalJson(item, '$.metric_set.first_resolution_time_in_minutes.calendar')}","requesterUpdatedAt":"@{toDateTime(evalJson(item, '$.metric_set.requester_updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","createdAt":"@{toDateTime(evalJson(item, '$.metric_set.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","initiallyAssignedAt":"@{toDateTime(evalJson(item, '$.metric_set.initially_assigned_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updatedAt":"@{toDateTime(evalJson(item, '$.metric_set.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","latestCommentAddedAt":"@{toDateTime(evalJson(item, '$.metric_set.latest_comment_added_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","assignedAt":"@{toDateTime(evalJson(item, '$.metric_set.assigned_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","assigneeUpdatedAt":"@{toDateTime(evalJson(item, '$.metric_set.assignee_updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","statusUpdatedAt":"@{toDateTime(evalJson(item, '$.metric_set.status_updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","solvedAt":"@{toDateTime(evalJson(item, '$.metric_set.solved_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"}},"outputs":[{"name":"success","destination":"save_ticket_metrics","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_ticket_metrics","properties":{"tableName":"TicketMetrics","batchSize":200,"fields":["ticketId","agentWaitTimeInMinutesCalendar","agentWaitTimeInMinutesBusiness","requesterWaitTimeInMinutesBusiness","requesterWaitTimeInMinutesCalendar","firstResolutionTimeInMinutesBusiness","firstResolutionTimeInMinutesCalendar","onHoldTimeInMinutesBusiness","onHoldTimeInMinutesCalendar","replyTimeInMinutesCalendar","replyTimeInMinutesBusiness","fullResolutionTimeInMinutesCalendar","fullResolutionTimeInMinutesBusiness","reopens","Groupstations","replies","assigneeStations","requesterUpdatedAt","statusUpdatedAt","assignedAt","assigneeUpdatedAt","createdAt","updatedAt","latestCommentAddedAt","initiallyAssignedAt","solvedAt"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"JsonToMap","name":"map_ticket","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","assigneeId":"@{evalJson(item, '$.assignee_id')}","subject":"@{evalJson(item, '$.subject')}","description":"@{evalJson(item, '$.description')}","type":"@{evalJson(item, '$.type')}","priority":"@{evalJson(item, '$.priority')}","incidentCount":"@{evalJson(item, '$.incident_count')}","status":"@{evalJson(item, '$.status')}","requesterId":"@{evalJson(item, '$.requester_id')}","isPublic":"@{evalJson(item, '$.is_public')}","url":"@{evalJson(item, '$.url')}","brandId":"@{evalJson(item, '$.brand_id')}","groupId":"@{evalJson(item, '$.group_id')}","organizationId":"@{evalJson(item, '$.organization_id')}","problemId":"@{evalJson(item, '$.problem_id')}","viaChannel":"@{evalJson(item, '$.via.channel')}","submitterId":"@{evalJson(item, '$.submitter_id')}","satisfactionRatingScore":"@{evalJson(item, '$.satisfaction_rating.score')}","satisfactionRatingComment":"@{evalJson(item, '$.satisfaction_rating.comment')}","createdAt":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updatedAt":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","dueAt":"@{toDateTime(evalJson(item, '$.due_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","initiallyAssignedAt":"@{toDateTime(evalJson(item, '$.dates.initially_assigned_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","latestCommentAddedAt":"@{toDateTime(evalJson(item, '$.dates.latest_comment_added_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","solvedAt":"@{toDateTime(evalJson(item, '$.dates.solved_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","requesterUpdatedAt":"@{toDateTime(evalJson(item, '$.dates.requester_updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","assignedAt":"@{toDateTime(evalJson(item, '$.dates.assigned_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","assigneeUpdatedAt":"@{toDateTime(evalJson(item, '$.dates.assignee_updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","statusUpdatedAt":"@{toDateTime(evalJson(item, '$.dates.status_updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"},"excludes":["comment_count","email_cc_ids","created_at","external_id","via","allow_attachments","updated_at","problem_id","follower_ids","due_at","metric_events","assignee_id","raw_subject","forum_topic_id","custom_fields","allow_channelback","satisfaction_rating","submitter_id","dates","collaborator_ids","satisfaction_probability","satisfaction_probability","brand_id","ticket_form_id","metric_set","sharing_agreement_ids","group_id","organization_id","followup_ids","recipient","is_public","has_incidents","fields","slas","requester_id","last_audit","tags","generated_timestamp","incident_count"]},"outputs":[{"name":"success","destination":"save_tickets","condition":null}],"itemAttributes":{"customFieldNames":"@{evalJson(credentials.config.properties,'$.customFields[*].title')}","fields":["id","subject","groupId","description","satisfactionRatingScore","type","organizationId","createdAt","initiallyAssignedAt","viaChannel","submitterId","assignedAt","isPublic","updatedAt","statusUpdatedAt","requesterUpdatedAt","priority","url","dueAt","solvedAt","brandId","problemId","satisfactionRatingComment","status","requesterId","requesterName","requesterRole","requesterTimezone","requesterLocale","requesterActive","requesterEmail","createCountry","createLocation","createLatitude","createLongitude","createClientAgent","assigneeUpdatedAt","latestCommentAddedAt","assigneeId","incidentCount"]},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_tickets","properties":{"tableName":"Tickets","batchSize":200,"fields":"@{CollectionUtils.collate(evalJson(item.attributes.fields, '$[*]'), item.attributes.customFieldNames)}"},"outputs":[],"itemAttributes":{},"extendsStep":null}],"excludes":["get_custom_fields","get_tickets_full","get_metric_events","clean_audits_after_last_execution","get_brands","get_deleted_tickets"],"generalSteps":[],"dependencies":null,"ignoreExceptionTypes":null,"exceptionIgnoreExpression":null},"extractor":{"id":0,"publicId":null,"lastExecution":null,"startExecution":null,"finishExecution":null,"queuedExecution":null,"nextExecution":null,"timeUnit":null,"timePeriod":0,"active":false,"status":null,"errorType":null,"message":null,"errorCounter":0,"fullExtraction":true},"connectorCredentials":{"id":0,"organizationId":35,"datasourceId":616,"connectorType":null,"creationDate":null,"refreshToken":"246ddac0c08054ff8982461683fd1d29cf6e7fd5cba3e8a57b46a311d8da961f","datamart":"localhost","config":"{\"properties\":{\"pageId\":\"100230508074773910534\",\"domain\":\"equiti-helpdesk\",\"customFields\":[{\"id\":360003885099,\"title\":\"Ddown1\"},{\"id\":360003890759,\"title\":\"Mult1\"},{\"id\":360001486872,\"title\":\"3rd Line Product support Type of Change/Request\"},{\"id\":360001063512,\"title\":\"2nd Line Legacy CWT Type of Change/Request\"},{\"id\":360002165852,\"title\":\"Mark as Spam\"},{\"id\":360001063532,\"title\":\"3rd Line Accounts and Admin (UK) Type of Change/Request\"},{\"id\":360001062512,\"title\":\"2nd Line CWT Type of Change/Request\"},{\"id\":360001123991,\"title\":\"1st Line Type of Change/Request\"},{\"id\":360001124771,\"title\":\"3rd Line Content (UK) Type of Change/Request\"},{\"id\":360001227172,\"title\":\"Country\"},{\"id\":360001124011,\"title\":\"2nd Line CTT Type of Change/Request\"},{\"id\":360001227992,\"title\":\"Phone Number - Only from form submission\"}],\"clientCustomerIds\":[\"8670301477\"],\"reports\":[\"PLACEHOLDER_REPORT_Normal\",\"PLACEMENT_PERFORMANCE_REPORT_Normal\",\"PRODUCT_PARTITION_REPORT_Normal\",\"SEARCH_QUERY_PERFORMANCE_REPORT_Normal\",\"SHOPPING_PERFORMANCE_REPORT_ConversionSegmented\",\"SHOPPING_PERFORMANCE_REPORT_Normal\",\"TOP_CONTENT_PERFORMANCE_REPORT_Normal\",\"URL_PERFORMANCE_REPORT_ConversionSegmented\",\"URL_PERFORMANCE_REPORT_Normal\",\"USER_AD_DISTANCE_REPORT_Normal\",\"VIDEO_PERFORMANCE_REPORT_ConversionSegmented\",\"VIDEO_PERFORMANCE_REPORT_Normal\"]},\"to\":[],\"oauthAccessTokenSecret\":\"oLZCb0LjGWAmmTONV8ciiz9f6ng488dncQps2h1eo2s2D\"}","extractor":null}}