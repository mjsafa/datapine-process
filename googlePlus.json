{"processDefinition":{"name":"google-plus-activities","steps":[{"name":"cleanupActivities","type":"DeleteFromDB","properties":{"tableName":"activity"},"outputs":[{"name":"success","destination":"cleanupActivityMetrics"}]},{"name":"cleanupActivityMetrics","type":"DeleteFromDB","properties":{"tableName":"activityMetrics","predicates":[{"field":"extraction_date","operator":"between","start":"@{currentDate().atStartOfDay()}","end":"@{now()}"}]},"outputs":[{"name":"success","destination":"gPlusData"}],"itemAttributes":{}},{"name":"gPlusData","type":"GooglePlusConnector","properties":{"resource":"activities","userId":"@{evalJson(credentials.config.properties, '$.pageId')}","resultsPerPage":60},"outputs":[{"name":"success","destination":"toMap"},{"name":"success","destination":"toMapMetrics"}],"itemAttributes":{"firstAttachment":"@{listItem(evalJson(item, '$.object.attachments[*]'),0)}"}},{"name":"toMap","type":"ToMap","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","title":"@{evalJson(item, '$.title')}","actorId":"@{evalJson(item, '$.actor.id')}","published":"@{toDateTime(evalJson(item, '$.published'), 'yyyy-MM-dd\\'T\\'HH:mm:ss.SSSX')}","updated":"@{toDateTime(evalJson(item, '$.updated'), 'yyyy-MM-dd\\'T\\'HH:mm:ss.SSSX')}","url":"@{evalJson(item, '$.url')}","verb":"@{evalJson(item, '$.verb')}","objectType":"@{evalJson(item, '$.object.objectType')}","originalActivityId":"@{evalJson(item, '$.object.id')}","originalActorId":"@{evalJson(item, '$.object.actor.id')}","originalActorDisplayName":"@{evalJson(item, '$.object.actor.displayName')}","originalActorUrl":"@{evalJson(item, '$.object.actor.url')}","originalObjectUrl":"@{evalJson(item, '$.verb') == 'share' ? evalJson(item, '$.object.url') : ''}","content":"@{evalJson(item, '$.object.content')}","originalContent":"@{evalJson(item, '$.object.originalContent')}","plusOnersCount":"@{evalJson(item, '$.object.plusoners.totalItems')}","reshareCount":"@{evalJson(item, '$.object.resharers.totalItems')}","replyCount":"@{evalJson(item, '$.object.replies.totalItems')}","geoCode":"@{evalJson(item, '$.geocode')}","address":"@{evalJson(item, '$.address')}","placeName":"@{evalJson(item, '$.placeName')}","locationDisplayName":"@{evalJson(item, '$.location.displayName')}","locationAddress":"@{evalJson(item, '$.location.address.formatted')}","attachmentDisplayName":"@{item.?attributes.?firstAttachment.?displayName}","attachmentType":"@{item.?attributes.?firstAttachment.?objectType}","attachmentContent":"@{item.?attributes.?firstAttachment.?content}","attachmentUrl":"@{item.?attributes.?firstAttachment.?url}"}},"outputs":[{"name":"success","destination":"saveActivities"}],"itemAttributes":{}},{"name":"saveActivities","type":"InsertMapIntoDB","properties":{"tableName":"activity","batchSize":200,"fields":["id","title","actorId","published","updated","url","verb","objectType","originalActivityId","originalActorId","originalActorDisplayName","originalActorUrl","originalObjectUrl","content","originalContent","plusOnersCount","reshareCount","replyCount","geoCode","address","placeName","locationDisplayName","locationAddress","attachmentDisplayName","attachmentType","attachmentContent","attachmentUrl"]},"itemAttributes":{}},{"name":"toMapMetrics","type":"ToMap","properties":{"mappings":{"activityId":"@{evalJson(item, '$.id')}","plusOnersCount":"@{evalJson(item, '$.object.plusoners.totalItems')}","reshareCount":"@{evalJson(item, '$.object.resharers.totalItems')}","replyCount":"@{evalJson(item, '$.object.replies.totalItems')}","extraction_date":"@{now()}"}},"outputs":[{"name":"success","destination":"saveActivityMetrics"}],"itemAttributes":{}},{"name":"saveActivityMetrics","type":"InsertMapIntoDB","properties":{"tableName":"activityMetrics","batchSize":200},"itemAttributes":{}}]},"extractor":{"id":0,"timePeriod":0,"active":false,"errorCounter":0},"connectorCredentials":{"id":0,"organizationId":35,"datasourceId":32915,"refreshToken":"1/YK6CyZbP21UR1p2IdDeJyDArmw5nt5Maaog5lzYfI_M","datamart":"localhost","config":{"properties":{"pageId":"+Datapine","domain":"mettrr","customFields":[{"id":360001124611,"title":"3rd Line Tech Support (UK) Type of Change/Request"},{"id":360001486852,"title":"3rd Line Adwords management Type of Change/Request"},{"id":360001486872,"title":"3rd Line Product support Type of Change/Request"},{"id":360001063512,"title":"2nd Line Legacy CWT Type of Change/Request"},{"id":360002165852,"title":"Mark as Spam"},{"id":360001063532,"title":"3rd Line Accounts and Admin (UK) Type of Change/Request"},{"id":360001062512,"title":"2nd Line CWT Type of Change/Request"},{"id":360001123991,"title":"1st Line Type of Change/Request"},{"id":360001124771,"title":"3rd Line Content (UK) Type of Change/Request"},{"id":360001227172,"title":"Country"},{"id":360001124011,"title":"2nd Line CTT Type of Change/Request"},{"id":360001227992,"title":"Phone Number - Only from form submission"}],"clientCustomerIds":["8670301477"],"reports":["PLACEHOLDER_REPORT_Normal","PLACEMENT_PERFORMANCE_REPORT_Normal","PRODUCT_PARTITION_REPORT_Normal","SEARCH_QUERY_PERFORMANCE_REPORT_Normal","SHOPPING_PERFORMANCE_REPORT_ConversionSegmented","SHOPPING_PERFORMANCE_REPORT_Normal","TOP_CONTENT_PERFORMANCE_REPORT_Normal","URL_PERFORMANCE_REPORT_ConversionSegmented","URL_PERFORMANCE_REPORT_Normal","USER_AD_DISTANCE_REPORT_Normal","VIDEO_PERFORMANCE_REPORT_ConversionSegmented","VIDEO_PERFORMANCE_REPORT_Normal"]},"to":[],"oauthAccessTokenSecret":"oLZCb0LjGWAmmTONV8ciiz9f6ng488dncQps2h1eo2s2D"}}}