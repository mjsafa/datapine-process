{"processDefinition":{"name":"youtube-analytics-time-base","steps":[{"type":"DbSelect","name":"select_channels","properties":{"tableName":"Channels","fields":["Id","PublishedAt"],"batchSize":1,"predicates":[]},"outputs":[{"name":"success","destination":"clean_view_durations","condition":null}],"itemAttributes":{"channelId":"@{item != null ? item.content.Id}","channelPublishDate":"@{item != null ? item.content.PublishedAt.toLocalDateTime()}","startDate":"@{formatDate(extractor.lastExecution != null ? extractor.lastExecution.minusDays(10) : item.attributes.channelPublishDate, 'yyyy-MM-dd')}","endDate":"@{formatDate(now().plusDays(1), 'yyyy-MM-dd')}","countryMap":"@{['AF':'Afghanistan','AX':'Aland Islands','AL':'Albania','DZ':'Algeria','AS':'American Samoa','AD':'Andorra','AO':'Angola','AI':'Anguilla','AQ':'Antarctica','AG':'Antigua and Barbuda','AR':'Argentina','AM':'Armenia','AW':'Aruba','AU':'Australia','AT':'Austria','AZ':'Azerbaijan','BS':'Bahamas','BH':'Bahrain','BD':'Bangladesh','BB':'Barbados','BY':'Belarus','BE':'Belgium','BZ':'Belize','BJ':'Benin','BM':'Bermuda','BT':'Bhutan','BO':'Bolivia','BA':'Bosnia and Herzegovina','BW':'Botswana','BV':'Bouvet Island','BR':'Brazil','VG':'British Virgin Islands','IO':'British Indian Ocean Territory','BN':'Brunei Darussalam','BG':'Bulgaria','BF':'Burkina Faso','BI':'Burundi','KH':'Cambodia','CM':'Cameroon','CA':'Canada','CV':'Cape Verde','KY':'Cayman Islands','CF':'Central African Republic','TD':'Chad','CL':'Chile','CN':'China','HK':'Hong Kong, SAR China','MO':'Macao, SAR China','CX':'Christmas Island','CC':'Cocos (Keeling) Islands','CO':'Colombia','KM':'Comoros','CG':'Congo (Brazzaville)','CD':'Congo, (Kinshasa)','CK':'Cook Islands','CR':'Costa Rica','CI':'Côte d`Ivoire','HR':'Croatia','CU':'Cuba','CY':'Cyprus','CZ':'Czech Republic','DK':'Denmark','DJ':'Djibouti','DM':'Dominica','DO':'Dominican Republic','EC':'Ecuador','EG':'Egypt','SV':'El Salvador','GQ':'Equatorial Guinea','ER':'Eritrea','EE':'Estonia','ET':'Ethiopia','FK':'Falkland Islands (Malvinas)','FO':'Faroe Islands','FJ':'Fiji','FI':'Finland','FR':'France','GF':'French Guiana','PF':'French Polynesia','TF':'French Southern Territories','GA':'Gabon','GM':'Gambia','GE':'Georgia','DE':'Germany','GH':'Ghana','GI':'Gibraltar','GR':'Greece','GL':'Greenland','GD':'Grenada','GP':'Guadeloupe','GU':'Guam','GT':'Guatemala','GG':'Guernsey','GN':'Guinea','GW':'Guinea-Bissau','GY':'Guyana','HT':'Haiti','HM':'Heard and Mcdonald Islands','VA':'Holy See (Vatican City State)','HN':'Honduras','HU':'Hungary','IS':'Iceland','IN':'India','ID':'Indonesia','IR':'Iran, Islamic Republic of','IQ':'Iraq','IE':'Ireland','IM':'Isle of Man','IL':'Israel','IT':'Italy','JM':'Jamaica','JP':'Japan','JE':'Jersey','JO':'Jordan','KZ':'Kazakhstan','KE':'Kenya','KI':'Kiribati','KP':'Korea (North)','KR':'Korea (South)','KW':'Kuwait','KG':'Kyrgyzstan','LA':'Lao PDR','LV':'Latvia','LB':'Lebanon','LS':'Lesotho','LR':'Liberia','LY':'Libya','LI':'Liechtenstein','LT':'Lithuania','LU':'Luxembourg','MK':'Macedonia, Republic of','MG':'Madagascar','MW':'Malawi','MY':'Malaysia','MV':'Maldives','ML':'Mali','MT':'Malta','MH':'Marshall Islands','MQ':'Martinique','MR':'Mauritania','MU':'Mauritius','YT':'Mayotte','MX':'Mexico','FM':'Micronesia, Federated States of','MD':'Moldova','MC':'Monaco','MN':'Mongolia','ME':'Montenegro','MS':'Montserrat','MA':'Morocco','MZ':'Mozambique','MM':'Myanmar','NA':'Namibia','NR':'Nauru','NP':'Nepal','NL':'Netherlands','AN':'Netherlands Antilles','NC':'New Caledonia','NZ':'New Zealand','NI':'Nicaragua','NE':'Niger','NG':'Nigeria','NU':'Niue','NF':'Norfolk Island','MP':'Northern Mariana Islands','NO':'Norway','OM':'Oman','PK':'Pakistan','PW':'Palau','PS':'Palestinian Territory','PA':'Panama','PG':'Papua New Guinea','PY':'Paraguay','PE':'Peru','PH':'Philippines','PN':'Pitcairn','PL':'Poland','PT':'Portugal','PR':'Puerto Rico','QA':'Qatar','RE':'Réunion','RO':'Romania','RU':'Russian Federation','RW':'Rwanda','BL':'Saint-Barthélemy','SH':'Saint Helena','KN':'Saint Kitts and Nevis','LC':'Saint Lucia','MF':'Saint-Martin (French part)','PM':'Saint Pierre and Miquelon','VC':'Saint Vincent and Grenadines','WS':'Samoa','SM':'San Marino','ST':'Sao Tome and Principe','SA':'Saudi Arabia','SN':'Senegal','RS':'Serbia','SC':'Seychelles','SL':'Sierra Leone','SG':'Singapore','SK':'Slovakia','SI':'Slovenia','SB':'Solomon Islands','SO':'Somalia','ZA':'South Africa','GS':'South Georgia and the South Sandwich Islands','SS':'South Sudan','ES':'Spain','LK':'Sri Lanka','SD':'Sudan','SR':'Suriname','SJ':'Svalbard and Jan Mayen Islands','SZ':'Swaziland','SE':'Sweden','CH':'Switzerland','SY':'Syrian Arab Republic (Syria)','TW':'Taiwan, Republic of China','TJ':'Tajikistan','TZ':'Tanzania, United Republic of','TH':'Thailand','TL':'Timor-Leste','TG':'Togo','TK':'Tokelau','TO':'Tonga','TT':'Trinidad and Tobago','TN':'Tunisia','TR':'Turkey','TM':'Turkmenistan','TC':'Turks and Caicos Islands','TV':'Tuvalu','UG':'Uganda','UA':'Ukraine','AE':'United Arab Emirates','GB':'United Kingdom','US':'United States of America','UM':'US Minor Outlying Islands','UY':'Uruguay','UZ':'Uzbekistan','VU':'Vanuatu','VE':'Venezuela (Bolivarian Republic)','VN':'Viet Nam','VI':'Virgin Islands, US','WF':'Wallis and Futuna Islands','EH':'Western Sahara','YE':'Yemen','ZM':'Zambia','ZW':'Zimbabwe', 'OO': 'Other']}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_view_durations","properties":{"tables":["TotalViewDurations"],"predicates":[{"field":"ChannelId","operator":"=","value":"@{item.attributes.channelId}"}]},"outputs":[{"name":"success","destination":"select_all_countries","condition":null},{"name":"success","destination":"total_average_view_duration_report","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"YouTubeAnalytics","name":"total_average_view_duration_report","properties":{"url":"reports","params":{"dimensions":"","ids":"channel==@{item.attributes.channelId}","metrics":"averageViewDuration,averageViewPercentage","startDate":"@{formatDate(item.attributes.channelPublishDate, 'yyyy-MM-dd')}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"TotalViewDurations","fields":"@{['AverageViewDuration','AverageViewPercentage', 'ChannelId', 'Entity']}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_time_based_totals","properties":{"tables":["TimeBasedReportsWithoutCountry"],"predicates":[{"field":"Day","operator":">=","value":"@{toDate(item.attributes.startDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"Day","operator":"<","value":"@{toDate(item.attributes.endDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"ChannelId","operator":"=","value":"@{item.attributes.channelId}"},{"field":"VideoId","operator":"in","value":"@{item.attributes.videoIdList}"}]},"outputs":[{"name":"success","destination":"report_timebased_total","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"YouTubeAnalytics","name":"report_timebased_total","properties":{"url":"reports","params":{"dimensions":"day,video","filters":"video==@{item.attributes.videoId}","ids":"channel==@{item.attributes.channelId}","metrics":"views,redViews,comments,likes,dislikes,videosAddedToPlaylists,videosRemovedFromPlaylists,shares,estimatedMinutesWatched,estimatedRedMinutesWatched,averageViewDuration,averageViewPercentage,annotationClickThroughRate,annotationCloseRate,annotationImpressions,annotationClickableImpressions,annotationClosableImpressions,annotationClicks,annotationCloses,cardClickRate,cardTeaserClickRate,cardImpressions,cardTeaserImpressions,cardClicks,cardTeaserClicks,subscribersGained,subscribersLost","startDate":"@{item.attributes.startDate}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"TimeBasedReportsWithoutCountry","fields":"@{['Day','VideoId','Views','RedViews','Comments','Likes','Dislikes','VideosAddedToPlaylists','VideosRemovedFromPlaylists','Shares','EstimatedMinutesWatched','EstimatedRedMinutesWatched','AverageViewDuration','AverageViewPercentage','AnnotationClickThroughRate','AnnotationCloseRate','AnnotationImpressions','AnnotationClickableImpressions','AnnotationClosableImpressions','AnnotationClicks','AnnotationCloses','CardClickRate','CardTeaserClickRate','CardImpressions','CardTeaserImpressions','CardClicks','CardTeaserClicks','SubscribersGained','SubscribersLost', 'ChannelId', 'Entity']}"},"extendsStep":null},{"type":"DbSelect","name":"select_video_ids","properties":{"tableName":"Videos","fields":["Id"],"batchSize":200,"predicates":[{"field":"channelId","operator":"=","value":"@{item.attributes.channelId}"}]},"outputs":[{"name":"success","destination":"split_countries","condition":null},{"name":"success","destination":"clean_rows","condition":null},{"name":"success","destination":"clean_time_based_totals","condition":null},{"name":"success","destination":"total_average_durations_per_video","condition":null}],"itemAttributes":{"videoId":"@{joinToString(evalJson(toJson(item.content), '$[*].Id'), ',')}","videoIdList":"@{evalJson(toJson(item.content), '$[*].Id')}"},"extendsStep":null},{"type":"YouTubeAnalytics","name":"total_average_durations_per_video","properties":{"url":"reports","params":{"dimensions":"video","filters":"video==@{item.attributes.videoId}","ids":"channel==@{item.attributes.channelId}","metrics":"averageViewDuration,averageViewPercentage","startDate":"@{formatDate(item.attributes.channelPublishDate, 'yyyy-MM-dd')}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"TotalViewDurations","fields":"@{['VideoId','AverageViewDuration','AverageViewPercentage', 'ChannelId', 'Entity']}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_timebased_total_channel","properties":{"tables":["TimeBasedReportsWithoutCountry"],"predicates":[{"field":"Day","operator":">=","value":"@{toDate(item.attributes.startDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"Day","operator":"<","value":"@{toDate(item.attributes.endDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"ChannelId","operator":"=","value":"@{item.attributes.channelId}"},{"field":"VideoId","operator":"isNull"}]},"outputs":[{"name":"success","destination":"reports_timebased_total_channel","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"YouTubeAnalytics","name":"reports_timebased_total_channel","properties":{"url":"reports","params":{"dimensions":"day","ids":"channel==@{item.attributes.channelId}","metrics":"views,redViews,comments,likes,dislikes,videosAddedToPlaylists,videosRemovedFromPlaylists,shares,estimatedMinutesWatched,estimatedRedMinutesWatched,averageViewDuration,averageViewPercentage,annotationClickThroughRate,annotationCloseRate,annotationImpressions,annotationClickableImpressions,annotationClosableImpressions,annotationClicks,annotationCloses,cardClickRate,cardTeaserClickRate,cardImpressions,cardTeaserImpressions,cardClicks,cardTeaserClicks,subscribersGained,subscribersLost","startDate":"@{item.attributes.startDate}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"TimeBasedReportsWithoutCountry","fields":"@{['Day','VideoId','Views','RedViews','Comments','Likes','Dislikes','VideosAddedToPlaylists','VideosRemovedFromPlaylists','Shares','EstimatedMinutesWatched','EstimatedRedMinutesWatched','AverageViewDuration','AverageViewPercentage','AnnotationClickThroughRate','AnnotationCloseRate','AnnotationImpressions','AnnotationClickableImpressions','AnnotationClosableImpressions','AnnotationClicks','AnnotationCloses','CardClickRate','CardTeaserClickRate','CardImpressions','CardTeaserImpressions','CardClicks','CardTeaserClicks','SubscribersGained','SubscribersLost', 'ChannelId', 'Entity']}"},"extendsStep":null},{"type":"DbSelect","name":"select_all_countries","properties":{"tableName":"UserGeography","distinctOn":["Country"],"batchSize":0,"predicates":[]},"outputs":[{"name":"success","destination":"select_video_ids","condition":null},{"name":"success","destination":"clean_general_reports","condition":null},{"name":"success","destination":"clean_timebased_total_channel","condition":null}],"itemAttributes":{"countries":"@{evalJson(toJson(item.content), '$[*].Country')}","countries1":"@{['DE', 'US', 'ZZ']}","startDate":"@{formatDate(extractor.lastExecution != null ? extractor.lastExecution.minusDays(10) : item.attributes.channelPublishDate, 'yyyy-MM-dd')}","endDate":"@{formatDate(now().plusDays(1), 'yyyy-MM-dd')}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_countries_for_channel","properties":{"array":"@{item.attributes.countries}"},"outputs":[{"name":"success","destination":"time_based_channel_report","condition":null}],"itemAttributes":{"country":"@{item.content}"},"extendsStep":null},{"type":"YouTubeAnalytics","name":"time_based_channel_report","properties":{"url":"reports","params":{"dimensions":"day","filters":"country==@{item.attributes.country}","ids":"channel==@{item.attributes.channelId}","metrics":"views,comments,likes,dislikes,videosAddedToPlaylists,videosRemovedFromPlaylists,shares,estimatedMinutesWatched,averageViewDuration,averageViewPercentage,annotationClickThroughRate,annotationCloseRate,annotationImpressions,annotationClickableImpressions,annotationClosableImpressions,annotationClicks,annotationCloses,cardClickRate,cardTeaserClickRate,cardImpressions,cardTeaserImpressions,cardClicks,cardTeaserClicks,subscribersGained,subscribersLost","startDate":"@{item.attributes.startDate}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"TimeBasedReports","fields":"@{['Day','VideoId', 'Country','Views','RedViews','Comments','Likes','Dislikes','VideosAddedToPlaylists','VideosRemovedFromPlaylists','Shares','EstimatedMinutesWatched','EstimatedRedMinutesWatched','AverageViewDuration','AverageViewPercentage','AnnotationClickThroughRate','AnnotationCloseRate','AnnotationImpressions','AnnotationClickableImpressions','AnnotationClosableImpressions','AnnotationClicks','AnnotationCloses','CardClickRate','CardTeaserClickRate','CardImpressions','CardTeaserImpressions','CardClicks','CardTeaserClicks','SubscribersGained','SubscribersLost', 'ChannelId', 'Entity']}"},"extendsStep":null},{"type":"YouTubeAnalytics","name":"channel_traffic_source_report","properties":{"url":"reports","params":{"dimensions":"day,insightTrafficSourceType,liveOrOnDemand","ids":"channel==@{item.attributes.channelId}","metrics":"views,estimatedMinutesWatched","startDate":"@{item.attributes.startDate}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"TrafficSources","fields":"@{['Views','RedViews','EstimatedMinutesWatched','EstimatedRedMinutesWatched','InsightTrafficSourceType','LiveOrOnDemand','Day', 'ChannelId', 'Entity']}","trafficSourceMap":"@{['UNKNOWN_MOBILE_OR_DIRECT': 'Direct or unknown', 'NO_LINK_OTHER': 'Direct or unknown','ADVERTISING': 'YouTube advertising','SUBSCRIBER': 'Browse features','YT_CHANNEL':'YouTube channels','YT_SEARCH':'YouTube search','RELATED_VIDEO':'Suggested videos','YT_RELATED':'Suggested videos','YT_OTHER_PAGE':'Other YouTube features','EXT_URL':'External','ANNOTATION':'Video cards and annotations','PLAYLIST':'Playlists','NOTIFICATION':'Notifications','YT_PLAYLIST_PAGE':'Playlist pages','CAMPAIGN_CARD':'Programming from claimed content','END_SCREEN':'Interactive video endscreen']}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_general_reports","properties":{"tables":["TimeBasedReports","TrafficSources","Devices"],"predicates":[{"field":"Day","operator":">=","value":"@{toDate(item.attributes.startDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"Day","operator":"<","value":"@{toDate(item.attributes.endDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"ChannelId","operator":"=","value":"@{item.attributes.channelId}"},{"field":"VideoId","operator":"isNull"}]},"outputs":[{"name":"success","destination":"channel_traffic_source_report","condition":null},{"name":"success","destination":"channel_device_report","condition":null},{"name":"success","destination":"split_countries_for_channel","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"YouTubeAnalytics","name":"channel_device_report","properties":{"url":"reports","params":{"dimensions":"deviceType,liveOrOnDemand,youtubeProduct,day,operatingSystem","ids":"channel==MINE","metrics":"views,estimatedMinutesWatched","startDate":"@{item.attributes.startDate}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"Devices","fields":"@{['DeviceType','OperatingSystem','LiveOrOnDemand','YoutubeProduct','Day', 'Views','EstimatedMinutesWatched','RedViews','EstimatedRedMinutesWatched', 'ChannelId', 'Entity']}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_countries","properties":{"array":"@{item.attributes.countries}"},"outputs":[{"name":"success","destination":"clean_time_based_with_country","condition":null}],"itemAttributes":{"country":"@{item.content}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_time_based_with_country","properties":{"tables":["TimeBasedReports"],"predicates":[{"field":"Day","operator":">=","value":"@{toDate(item.attributes.startDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"Day","operator":"<","value":"@{toDate(item.attributes.endDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"VideoId","operator":"in","value":"@{item.attributes.videoIdList}"},{"field":"Country","operator":"=","value":"@{item.attributes.country == 'ZZ' ? 'UNKNOWN': item.attributes.country}"}]},"outputs":[{"name":"success","destination":"report_timebased","condition":null}],"itemAttributes":{"country":"@{item.content}"},"extendsStep":null},{"type":"YouTubeAnalytics","name":"traffic_sources_report","properties":{"url":"reports","params":{"dimensions":"day,insightTrafficSourceType,liveOrOnDemand,video","filters":"video==@{item.attributes.videoId}","ids":"channel==@{item.attributes.channelId}","metrics":"views,estimatedMinutesWatched","startDate":"@{item.attributes.startDate}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"TrafficSources","fields":"@{['Views','RedViews','EstimatedMinutesWatched','EstimatedRedMinutesWatched','InsightTrafficSourceType','LiveOrOnDemand','Day','VideoId', 'ChannelId', 'Entity']}","trafficSourceMap":"@{['UNKNOWN_MOBILE_OR_DIRECT': 'Direct or unknown', 'NO_LINK_OTHER': 'Direct or unknown','ADVERTISING': 'YouTube advertising','SUBSCRIBER': 'Browse features','YT_CHANNEL':'YouTube channels','YT_SEARCH':'YouTube search','RELATED_VIDEO':'Suggested videos','YT_RELATED':'Suggested videos','YT_OTHER_PAGE':'Other YouTube features','EXT_URL':'External','ANNOTATION':'Video cards and annotations','PLAYLIST':'Playlists','NOTIFICATION':'Notifications','YT_PLAYLIST_PAGE':'Playlist pages','CAMPAIGN_CARD':'Programming from claimed content','END_SCREEN':'Interactive video endscreen']}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_rows","properties":{"tables":["TrafficSources","Devices"],"predicates":[{"field":"Day","operator":">=","value":"@{toDate(item.attributes.startDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"Day","operator":"<","value":"@{toDate(item.attributes.endDate, 'yyyy-MM-dd').atStartOfDay()}"},{"field":"VideoId","operator":"in","value":"@{item.attributes.videoIdList}"}]},"outputs":[{"name":"success","destination":"report_device","condition":null},{"name":"success","destination":"traffic_sources_report","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"YouTubeAnalytics","name":"report_device","properties":{"url":"reports","params":{"dimensions":"deviceType,liveOrOnDemand,youtubeProduct,day,video,operatingSystem","filters":"video==@{item.attributes.videoId}","ids":"channel==MINE","metrics":"views,estimatedMinutesWatched","startDate":"@{item.attributes.startDate}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"Devices","fields":"@{['DeviceType', 'OperatingSystem','LiveOrOnDemand','YoutubeProduct','Day','VideoId', 'Views','EstimatedMinutesWatched','RedViews','EstimatedRedMinutesWatched', 'ChannelId', 'Entity']}"},"extendsStep":null},{"type":"YouTubeAnalytics","name":"report_timebased","properties":{"url":"reports","params":{"dimensions":"day,video","filters":"video==@{item.attributes.videoId};country==@{item.attributes.country}","ids":"channel==@{item.attributes.channelId}","metrics":"views,comments,likes,dislikes,videosAddedToPlaylists,videosRemovedFromPlaylists,shares,estimatedMinutesWatched,averageViewDuration,averageViewPercentage,annotationClickThroughRate,annotationCloseRate,annotationImpressions,annotationClickableImpressions,annotationClosableImpressions,annotationClicks,annotationCloses,cardClickRate,cardTeaserClickRate,cardImpressions,cardTeaserImpressions,cardClicks,cardTeaserClicks,subscribersGained,subscribersLost","startDate":"@{item.attributes.startDate}","endDate":"@{item.attributes.endDate}"}},"outputs":[{"name":"success","destination":"process_rows","condition":null}],"itemAttributes":{"table":"TimeBasedReports","fields":"@{['Day','VideoId', 'Country','Views','RedViews','Comments','Likes','Dislikes','VideosAddedToPlaylists','VideosRemovedFromPlaylists','Shares','EstimatedMinutesWatched','EstimatedRedMinutesWatched','AverageViewDuration','AverageViewPercentage','AnnotationClickThroughRate','AnnotationCloseRate','AnnotationImpressions','AnnotationClickableImpressions','AnnotationClosableImpressions','AnnotationClicks','AnnotationCloses','CardClickRate','CardTeaserClickRate','CardImpressions','CardTeaserImpressions','CardClicks','CardTeaserClicks','SubscribersGained','SubscribersLost', 'ChannelId', 'Entity']}"},"extendsStep":null},{"type":"CreateJsonObjects","name":"process_rows","properties":{"keys":"@{evalJson(item, '$.columnHeaders[*].name')}","values":"@{evalJson(item, '$.rows')}","multiple":true},"outputs":[{"name":"success","destination":"upper_keys","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ModifyJsonItems","name":"upper_keys","properties":{"keyExpression":"${upperFirstLetter(key)}"},"outputs":[{"name":"success","destination":"map_row","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"JsonToMap","name":"map_row","properties":{"mappings":{"Day":"@{null != evalJson(item, '$.Day') ? toDate(evalJson(item, '$.Day'), 'yyyy-MM-dd').atStartOfDay()}","DeviceType":"@{evalJson(item, '$.DeviceType') != null ? capitalizeFully(evalJson(item, '$.DeviceType'),'_')}","OperatingSystem":"@{evalJson(item, '$.OperatingSystem') != null ? capitalizeFully(evalJson(item, '$.OperatingSystem'),'_')}","VideoId":"@{evalJson(item, '$.Video') != null ? evalJson(item, '$.Video') : item.attributes.?videoId}","Entity":"@{evalJson(item, '$.Video') != null || item.attributes.?videoId != null ? 'VIDEO' : 'CHANNEL'}","Country":"@{item.attributes.?country != null ? (item.attributes.country == 'ZZ' ? 'UNKNOWN' : item.attributes.countryMap.getOrDefault(item.attributes.country,item.attributes.country)) : null}","InsightTrafficSourceType":"@{null != evalJson(item, '$.InsightTrafficSourceType') ? item.attributes.trafficSourceMap.get(evalJson(item, '$.InsightTrafficSourceType')) : null}","ChannelId":"@{item.attributes.channelId}"},"excludes":["Video"]},"outputs":[{"name":"success","destination":"save_reports","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_reports","properties":{"tableName":"@{item.attributes.table}","batchSize":200,"fields":"@{item.attributes.fields}"},"outputs":[],"itemAttributes":{},"extendsStep":null}],"excludes":[],"generalSteps":[],"dependencies":["youtube-analytics"],"ignoreExceptionTypes":null,"exceptionIgnoreExpression":null},"extractor":{"id":0,"publicId":null,"lastExecution":null,"startExecution":null,"finishExecution":null,"queuedExecution":null,"nextExecution":null,"timeUnit":null,"timePeriod":0,"active":false,"status":null,"errorType":null,"message":null,"errorCounter":0,"fullExtraction":true},"connectorCredentials":{"id":0,"organizationId":28,"datasourceId":99,"connectorType":null,"creationDate":null,"refreshToken":"1//03rhXyfbJ34wdCgYIARAAGAMSNwF-L9Ir-NJ-Kcl7_Qu7z2H_TCbjh6e42gs9X6OtvI8iYDa-qmVmrQw2cKx2xSGFl1csQhVuNUc","datamart":"localhost","config":"{\"properties\":{\"pageId\":\"112263752521477124308\",\"domain\":\"mettrr\",\"customFields\":[{\"id\":360001124611,\"title\":\"3rd Line Tech Support (UK) Type of Change/Request\"},{\"id\":360001486852,\"title\":\"3rd Line Adwords management Type of Change/Request\"},{\"id\":360001486872,\"title\":\"3rd Line Product support Type of Change/Request\"},{\"id\":360001063512,\"title\":\"2nd Line Legacy CWT Type of Change/Request\"},{\"id\":360002165852,\"title\":\"Mark as Spam\"},{\"id\":360001063532,\"title\":\"3rd Line Accounts and Admin (UK) Type of Change/Request\"},{\"id\":360001062512,\"title\":\"2nd Line CWT Type of Change/Request\"},{\"id\":360001123991,\"title\":\"1st Line Type of Change/Request\"},{\"id\":360001124771,\"title\":\"3rd Line Content (UK) Type of Change/Request\"},{\"id\":360001227172,\"title\":\"Country\"},{\"id\":360001124011,\"title\":\"2nd Line CTT Type of Change/Request\"},{\"id\":360001227992,\"title\":\"Phone Number - Only from form submission\"}],\"clientCustomerIds\":[\"8670301477\"],\"reports\":[\"PLACEHOLDER_REPORT_Normal\",\"PLACEMENT_PERFORMANCE_REPORT_Normal\",\"PRODUCT_PARTITION_REPORT_Normal\",\"SEARCH_QUERY_PERFORMANCE_REPORT_Normal\",\"SHOPPING_PERFORMANCE_REPORT_ConversionSegmented\",\"SHOPPING_PERFORMANCE_REPORT_Normal\",\"TOP_CONTENT_PERFORMANCE_REPORT_Normal\",\"URL_PERFORMANCE_REPORT_ConversionSegmented\",\"URL_PERFORMANCE_REPORT_Normal\",\"USER_AD_DISTANCE_REPORT_Normal\",\"VIDEO_PERFORMANCE_REPORT_ConversionSegmented\",\"VIDEO_PERFORMANCE_REPORT_Normal\"]},\"to\":[],\"oauthAccessTokenSecret\":\"oLZCb0LjGWAmmTONV8ciiz9f6ng488dncQps2h1eo2s2D\"}","extractor":null}}