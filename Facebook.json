{"processDefinition":{"name":"Facebook-get-posts","steps":[{"type":"FacebookGraph","name":"get_facebook_pages","properties":{"url":"me/accounts","isSingleObject":false,"fields":["id","name","access_token","page_access_token"]},"outputs":[{"name":"success","destination":"select_min_Post_Date","condition":null}],"itemAttributes":{"pageId":"@{evalJson(item, '$.id')}","pageIdNumber":"@{evalJson(item, '$.id')}","pageAccessToken":"@{evalJson(item, '$.access_token')}"},"extendsStep":null},{"type":"DbFunction","name":"select_min_Post_Date","properties":{"field":"created_time","function":"min","tableName":"Posts","predicates":[{"field":"pageId","value":"@{item.attributes.pageId}"}]},"outputs":[{"name":"success","destination":"clean_all_posts","condition":null}],"itemAttributes":{"minPostDate":"@{item.content}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_all_posts","properties":{"tableName":"Posts","predicates":[{"field":"pageId","value":"@{item.attributes.pageId}"}]},"outputs":[{"name":"success","destination":"get_posts","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"FacebookGraph","name":"get_posts","properties":{"url":"/@{item.attributes.pageIdNumber}/posts","isSingleObject":false,"accessToken":"@{item.attributes.pageAccessToken}","parameters":{"limit":100,"since":"@{formatDate(item.attributes.?minPostDate != null ? item.attributes.?minPostDate :now().minusMonths(3).toLocalDate().atStartOfDay(), 'yyyy-MM-dd')}","until":"@{formatDate(now(), 'yyyy-MM-dd')}"},"fields":["id","created_time","is_published","message","shares","updated_time","attachments{media_type,unshimmed_url,title,description}"]},"outputs":[{"name":"success","destination":"map_posts","condition":null}],"itemAttributes":{"postId":"@{evalJson(item, '$.id')}"},"extendsStep":null},{"type":"JsonToMap","name":"map_posts","properties":{"mappings":{"pageId":"@{item.attributes.pageId}","shares":"@{evalJson(item, '$.shares.count')}","caption":"@{listItem(evalJson(item, '$.attachments.data[*].title'), 0)}","type":"@{listItem(evalJson(item, '$.attachments.data[*].media_type'), 0, 'status')}","link":"@{listItem(evalJson(item, '$.attachments.data[*].unshimmed_url'), 0)}","description":"@{listItem(evalJson(item, '$.attachments.data[*].description'), 0)}","created_time":"@{toDateTime(evalJson(item, '$.created_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ')}","updated_time":"@{toDateTime(evalJson(item, '$.updated_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ')}"}},"outputs":[{"name":"success","destination":"save_posts","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_posts","properties":{"tableName":"Posts","batchSize":200,"fields":["id","pageId","caption","created_time","description","is_published","message","link","shares","type","updated_time"]},"outputs":[],"itemAttributes":{},"extendsStep":null}],"excludes":[],"generalSteps":[],"dependencies":["PageInsights"],"ignoreExceptionTypes":null,"exceptionIgnoreExpression":null},"extractor":{"id":0,"publicId":null,"lastExecution":null,"startExecution":null,"finishExecution":null,"queuedExecution":null,"nextExecution":null,"timeUnit":null,"timePeriod":0,"active":false,"status":null,"errorType":null,"message":null,"errorCounter":0,"fullExtraction":true},"connectorCredentials":{"id":0,"organizationId":38,"datasourceId":1023896,"connectorType":null,"creationDate":null,"refreshToken":"EAAGuoVILSX4BABtXWOoLhmxPIfqZC8VTDICoVlZAr4jjJYklKjU6x3ykNPXIpjaoACZCXE0oj65Ei1sz8RYa0DpHdGtSfXZBhghcz7XZC8l27V84dF2pbcau9n0VjcFn0IxtgsIysYkXd86AiZBbd25YHk03lexbdQbDDcXG1SOgZDZD","datamart":"localhost","config":"{\"properties\":{\"pageId\":\"+ExoplatformTribe\",\"domain\":\"mettrr\",\"customFields\":[{\"id\":360001124611,\"title\":\"3rd Line Tech Support (UK) Type of Change/Request\"},{\"id\":360001486852,\"title\":\"3rd Line Adwords management Type of Change/Request\"},{\"id\":360001486872,\"title\":\"3rd Line Product support Type of Change/Request\"},{\"id\":360001063512,\"title\":\"2nd Line Legacy CWT Type of Change/Request\"},{\"id\":360002165852,\"title\":\"Mark as Spam\"},{\"id\":360001063532,\"title\":\"3rd Line Accounts and Admin (UK) Type of Change/Request\"},{\"id\":360001062512,\"title\":\"2nd Line CWT Type of Change/Request\"},{\"id\":360001123991,\"title\":\"1st Line Type of Change/Request\"},{\"id\":360001124771,\"title\":\"3rd Line Content (UK) Type of Change/Request\"},{\"id\":360001227172,\"title\":\"Country\"},{\"id\":360001124011,\"title\":\"2nd Line CTT Type of Change/Request\"},{\"id\":360001227992,\"title\":\"Phone Number - Only from form submission\"}],\"clientCustomerIds\":[\"8049594734\"],\"reports\":[\"ACCOUNT_PERFORMANCE_REPORT_Normal\"]},\"to\":[],\"oauthAccessTokenSecret\":\"oLZCb0LjGWAmmTONV8ciiz9f6ng488dncQps2h1eo2s2D\"}","extractor":null}}