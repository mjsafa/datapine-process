{"processDefinition":{"name":"PageInsights","steps":[{"type":"FacebookGraph","name":"get_facebook_pages","properties":{"url":"me/accounts","isSingleObject":false,"fields":["id","name","category","access_token","page_access_token"]},"outputs":[{"name":"success","destination":"page_intervals"},{"name":"success","destination":"clean_page"}],"itemAttributes":{"pageId":"@{evalJson(item, '$.id')}","pageIdNumber":"@{evalJson(item, '$.id')}","pageAccessToken":"@{evalJson(item, '$.access_token')}"}},{"type":"DeleteFromDB","name":"clean_page","properties":{"tableName":"Pages","predicates":[{"field":"id","operator":"=","value":"@{item.attributes.pageIdNumber}"}]},"outputs":[{"name":"success","destination":"map_pages"}],"itemAttributes":{}},{"type":"ToMap","name":"map_pages","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","name":"@{evalJson(item, '$.name')}","category":"@{evalJson(item, '$.category')}"}},"outputs":[{"name":"success","destination":"save_pages"}],"itemAttributes":{}},{"type":"InsertMapIntoDB","name":"save_pages","properties":{"tableName":"Pages"},"outputs":[],"itemAttributes":{}},{"type":"GetIntervals","name":"page_intervals","properties":{"totalMonths":18,"batchDays":60,"daysToExtract":28},"outputs":[{"name":"success","destination":"clean_tables"}],"itemAttributes":{"from":"@{item.content.from}","until":"@{item.content.until}"}},{"type":"DeleteFromDB","name":"clean_tables","properties":{"tables":["PageEngagement","PageImpressions","PagePost","PageReactions","PageStories","PageUsers","PageViews"],"predicates":[{"field":"extraction_date","value":"@{item.attributes.from.toLocalDate().atStartOfDay()}","operator":">="},{"field":"extraction_date","value":"@{item.attributes.until.toLocalDate().plusDays(1).atStartOfDay()}","operator":"<"},{"field":"pageId","value":"@{item.attributes.pageId}","operator":"="}]},"outputs":[{"name":"success","destination":"page_fans_insights"},{"name":"success","destination":"page_dayly_insights"}],"itemAttributes":{"from":"@{item.content.from}","until":"@{item.content.until}"}},{"type":"FacebookGraph","name":"page_fans_insights","properties":{"url":"/@{item.attributes.pageIdNumber}/insights","isSingleObject":false,"mergePages":true,"accessToken":"@{item.attributes.pageAccessToken}","parameters":{"period":"lifetime","metric":"page_fans,page_fans_locale,page_fans_city,page_fans_country,page_fans_gender_age","limit":200,"since":"@{formatDate(item.content.from, 'yyyy-MM-dd')}","until":"@{formatDate(item.content.until, 'yyyy-MM-dd')}"}},"outputs":[{"name":"success","destination":"fix_missing_values"}],"itemAttributes":{}},{"type":"JsonSetPath","name":"fix_missing_values","properties":{"paths":[{"path":"$.data[*].values[?(!@.value)]","value":0,"key":"value"}]},"outputs":[{"name":"success","destination":"merge_metrics"}],"itemAttributes":{}},{"type":"Merge","name":"merge_metrics","properties":{"leftStep":"page_dayly_insights","rightStep":"fix_missing_values"},"outputs":[{"name":"success","destination":"merge_fans_arrays"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_fans_locale","properties":{"property":"page_fans_locale"},"outputs":[{"name":"success","destination":"map_fans_locale"}],"itemAttributes":{}},{"type":"ToMap","name":"map_fans_locale","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_fans":"@{evalJson(item, '$.page_fans_locale_value')}","dimensionId":"locale_@{evalJson(item, '$.page_fans_locale_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_fans","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"InsertMapIntoDB","name":"save_fans","properties":{"tableName":"PageUsers","batchSize":400,"fields":["pageId","dimensionId","extraction_date","page_fans","page_fan_adds","page_fan_adds_unique","page_fan_removes","page_fan_removes_unique","page_fans_online"]},"outputs":[],"itemAttributes":{}},{"type":"MergeJsonArrays","name":"merge_fans_arrays","properties":{"split":true,"mainArray":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fan_adds\\')].values[*].end_time')}","itemExpression":"@{listItem(evalJson(array.toString(), '$[?(@.end_time==\\'' + mainArray.get(index) + '\\')].value'),0)}","arrays":{"page_fans":"@{evalJson(item.content.right, '$.data[?(@.name==\\'page_fans\\')].values[*]')}","page_fan_adds":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fan_adds\\')].values[*]')}","page_fan_adds_by_paid_non_paid_unique":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fan_adds_by_paid_non_paid_unique\\')].values[*]')}","page_fans_by_like_source":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fans_by_like_source\\')].values[*]')}","page_fans_by_like_source_unique":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fans_by_like_source_unique\\')].values[*]')}","page_fans_online":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fans_online_per_day\\')].values[*]')}","page_fans_online_per_hour":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fans_online\\')].values[*]')}","page_fan_adds_unique":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fan_adds_unique\\')].values[*]')}","page_fan_removes":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fan_removes\\')].values[*]')}","page_fan_removes_unique":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fan_removes_unique\\')].values[*]')}","page_fans_locale":"@{evalJson(item.content.right, '$.data[?(@.name==\\'page_fans_locale\\')].values[*]')}","page_fans_city":"@{evalJson(item.content.right, '$.data[?(@.name==\\'page_fans_city\\')].values[*]')}","page_fans_country":"@{evalJson(item.content.right, '$.data[?(@.name==\\'page_fans_country\\')].values[*]')}","page_fans_gender_age":"@{evalJson(item.content.right, '$.data[?(@.name==\\'page_fans_gender_age\\')].values[*]')}"},"additionalJsonProperties":{"extraction_date":"@{evalJson(item.content.left, '$.data[?(@.name==\\'page_fan_adds\\')].values[' + index + '].end_time')[0]}"}},"outputs":[{"name":"success","destination":"split_fans_locale"},{"name":"success","destination":"split_fans_city"},{"name":"success","destination":"split_fans_gender"},{"name":"success","destination":"split_fans_country"},{"name":"success","destination":"map_fans"},{"name":"success","destination":"split_fan_adds_paid_nonpaid"},{"name":"success","destination":"split_fans_like_source"},{"name":"success","destination":"split_fans_like_source_unique"},{"name":"success","destination":"split_fans_online_hour"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_fans_online_hour","properties":{"property":"page_fans_online_per_hour"},"outputs":[{"name":"success","destination":"map_fans_online_hour"}],"itemAttributes":{}},{"type":"ToMap","name":"map_fans_online_hour","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_fans_online":"@{evalJson(item, '$.page_fans_online_per_hour_value')}","dimensionId":"online_hour_@{evalJson(item, '$.page_fans_online_per_hour_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_fans","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_fans_like_source_unique","properties":{"property":"page_fans_by_like_source_unique"},"outputs":[{"name":"success","destination":"map_fans_like_source_unique"}],"itemAttributes":{}},{"type":"ToMap","name":"map_fans_like_source_unique","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_fan_adds_unique":"@{evalJson(item, '$.page_fans_by_like_source_unique_value')}","dimensionId":"like_source_@{evalJson(item, '$.page_fans_by_like_source_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_fans","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_fans_like_source","properties":{"property":"page_fans_by_like_source"},"outputs":[{"name":"success","destination":"map_fans_like_source"}],"itemAttributes":{}},{"type":"ToMap","name":"map_fans_like_source","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_fan_adds":"@{evalJson(item, '$.page_fans_by_like_source_value')}","dimensionId":"like_source_@{evalJson(item, '$.page_fans_by_like_source_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_fans","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"JsonToMap","name":"map_fans","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","pageId":"@{item.attributes.pageId}"},"excludes":["page_fans_locale","page_fans_city","page_fans_country","page_fans_gender_age","page_fan_adds_by_paid_non_paid_unique","page_fans_by_like_source_unique","page_fans_by_like_source","page_fans_online_per_hour"]},"outputs":[{"name":"success","destination":"save_fans","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_fans_country","properties":{"property":"page_fans_country"},"outputs":[{"name":"success","destination":"map_fans_country"}],"itemAttributes":{}},{"type":"ToMap","name":"map_fans_country","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_fans":"@{evalJson(item, '$.page_fans_country_value')}","dimensionId":"country_@{evalJson(item, '$.page_fans_country_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_fans","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_fans_gender","properties":{"property":"page_fans_gender_age"},"outputs":[{"name":"success","destination":"map_fans_gender"}],"itemAttributes":{}},{"type":"ToMap","name":"map_fans_gender","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_fans":"@{evalJson(item, '$.page_fans_gender_age_value')}","dimensionId":"gender_age_@{evalJson(item, '$.page_fans_gender_age_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_fans","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_fans_city","properties":{"property":"page_fans_city"},"outputs":[{"name":"success","destination":"map_fans_city"}],"itemAttributes":{}},{"type":"ToMap","name":"map_fans_city","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_fans":"@{evalJson(item, '$.page_fans_city_value')}","dimensionId":"city_@{evalJson(item, '$.page_fans_city_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_fans","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"FacebookGraph","name":"page_dayly_insights","properties":{"url":"/@{item.attributes.pageIdNumber}/insights","isSingleObject":false,"mergePages":true,"accessToken":"@{item.attributes.pageAccessToken}","parameters":{"period":"day","metric":"page_content_activity,page_content_activity_by_action_type,page_impressions,page_impressions_organic,page_impressions_organic_unique,page_impressions_paid,page_impressions_paid_unique,page_impressions_unique,page_impressions_viral,page_impressions_viral_unique,page_impressions_by_story_type,page_impressions_by_story_type_unique,page_impressions_by_city_unique,page_impressions_by_country_unique,page_impressions_by_age_gender_unique,page_impressions_viral_frequency_distribution,page_engaged_users,page_post_engagements,page_consumptions,page_consumptions_unique,page_places_checkin_total,page_places_checkin_total_unique,page_places_checkin_mobile,page_places_checkin_mobile_unique,page_negative_feedback,page_negative_feedback_unique,page_places_checkins_by_age_gender,page_places_checkins_by_locale,page_places_checkins_by_country,page_negative_feedback_by_type,page_negative_feedback_by_type_unique,page_consumptions_by_consumption_type,page_consumptions_by_consumption_type_unique,page_fans,page_fan_adds,page_fan_adds_unique,page_fan_removes,page_fan_removes_unique,page_actions_post_reactions_like_total,page_actions_post_reactions_love_total,page_actions_post_reactions_wow_total,page_actions_post_reactions_haha_total,page_actions_post_reactions_sorry_total,page_actions_post_reactions_anger_total,page_actions_post_reactions_total,page_posts_impressions,page_posts_impressions_unique,page_posts_impressions_paid,page_posts_impressions_paid_unique,page_posts_impressions_organic,page_posts_impressions_organic_unique,page_posts_impressions_viral,page_posts_impressions_viral_unique,page_posts_impressions_frequency_distribution,page_views_total,page_views_logged_in_unique,page_impressions_by_locale_unique,page_views_by_profile_tab_total,page_views_by_profile_tab_logged_in_unique,page_views_external_referrals,page_positive_feedback_by_type,page_positive_feedback_by_type_unique,page_fan_adds_by_paid_non_paid_unique,page_fans_by_like_source,page_fans_by_like_source_unique,page_fans_online,page_fans_online_per_day,page_impressions_frequency_distribution","limit":100,"since":"@{formatDate(item.attributes.from, 'yyyy-MM-dd')}","until":"@{formatDate(item.attributes.until, 'yyyy-MM-dd')}"}},"outputs":[{"name":"success","destination":"merge_stories_metrics"},{"name":"success","destination":"merge_page_impressions"},{"name":"success","destination":"merge_page_engagement"},{"name":"success","destination":"merge_metrics"},{"name":"success","destination":"merge_reactions"},{"name":"success","destination":"merge_page_posts"},{"name":"success","destination":"merge_page_views"}],"itemAttributes":{}},{"type":"MergeJsonArrays","name":"merge_page_views","properties":{"split":true,"mainArray":"@{evalJson(item, '$.data[?(@.name==\\'page_views_total\\')].values[*].end_time')}","itemExpression":"@{listItem(evalJson(array.toString(), '$[?(@.end_time==\\'' + mainArray.get(index) + '\\')].value'),0)}","arrays":{"page_views":"@{evalJson(item, '$.data[?(@.name==\\'page_views_total\\')].values[*]')}","page_views_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_views_logged_in_unique\\')].values[*]')}","page_views_by_profile_tab_total":"@{evalJson(item, '$.data[?(@.name==\\'page_views_by_profile_tab_total\\')].values[*]')}","page_views_by_profile_tab_logged_in_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_views_by_profile_tab_logged_in_unique\\')].values[*]')}","page_views_external_referrals":"@{evalJson(item, '$.data[?(@.name==\\'page_views_external_referrals\\')].values[*]')}"},"additionalJsonProperties":{"extraction_date":"@{evalJson(item, '$.data[?(@.name==\\'page_views_total\\')].values[' + index + '].end_time')[0]}"}},"outputs":[{"name":"success","destination":"map_page_views"},{"name":"success","destination":"split_page_views_tab"},{"name":"success","destination":"split_page_views_tab_unique"},{"name":"success","destination":"split_page_view_referals"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_page_view_referals","properties":{"property":"page_views_external_referrals"},"outputs":[{"name":"success","destination":"map_page_view_referal"}],"itemAttributes":{}},{"type":"ToMap","name":"map_page_view_referal","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_views":"@{evalJson(item, '$.page_views_external_referrals_value')}","dimensionId":"referral_@{evalJson(item, '$.page_views_external_referrals_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_page_views","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_page_views_tab_unique","properties":{"property":"page_views_by_profile_tab_logged_in_unique"},"outputs":[{"name":"success","destination":"map_page_views_tab_unique"}],"itemAttributes":{}},{"type":"ToMap","name":"map_page_views_tab_unique","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_views_unique":"@{evalJson(item, '$.page_views_by_profile_tab_logged_in_unique_value')}","dimensionId":"tab_@{evalJson(item, '$.page_views_by_profile_tab_logged_in_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_page_views","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_page_views_tab","properties":{"property":"page_views_by_profile_tab_total"},"outputs":[{"name":"success","destination":"map_page_views_tab_total"}],"itemAttributes":{}},{"type":"ToMap","name":"map_page_views_tab_total","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_views":"@{evalJson(item, '$.page_views_by_profile_tab_total_value')}","dimensionId":"tab_@{evalJson(item, '$.page_views_by_profile_tab_total_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_page_views","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"JsonToMap","name":"map_page_views","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","pageId":"@{item.attributes.pageId}"},"excludes":["page_views_by_profile_tab_total","page_views_by_profile_tab_logged_in_unique","page_views_external_referrals"]},"outputs":[{"name":"success","destination":"save_page_views","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"InsertMapIntoDB","name":"save_page_views","properties":{"tableName":"PageViews","batchSize":400,"fields":["pageId","dimensionId","extraction_date","page_views_unique","page_views"]},"outputs":[],"itemAttributes":{}},{"type":"MergeJsonArrays","name":"merge_page_posts","properties":{"split":true,"mainArray":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions\\')].values[*].end_time')}","itemExpression":"@{listItem(evalJson(array.toString(), '$[?(@.end_time==\\'' + mainArray.get(index) + '\\')].value'),0)}","arrays":{"page_posts_impressions":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions\\')].values[*]')}","page_posts_impressions_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions_unique\\')].values[*]')}","page_posts_impressions_paid":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions_paid\\')].values[*]')}","page_posts_impressions_paid_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions_paid_unique\\')].values[*]')}","page_posts_impressions_organic":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions_organic\\')].values[*]')}","page_posts_impressions_organic_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions_organic_unique\\')].values[*]')}","page_posts_impressions_viral":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions_viral\\')].values[*]')}","page_posts_impressions_viral_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions_viral_unique\\')].values[*]')}","page_posts_impressions_frequency_distribution":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions_frequency_distribution\\')].values[*]')}"},"additionalJsonProperties":{"extraction_date":"@{evalJson(item, '$.data[?(@.name==\\'page_posts_impressions\\')].values[' + index + '].end_time')[0]}"}},"outputs":[{"name":"success","destination":"map_page_posts"},{"name":"success","destination":"split_page_posts_frequency"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_page_posts_frequency","properties":{"property":"page_posts_impressions_frequency_distribution"},"outputs":[{"name":"success","destination":"map_page_post_frequency"}],"itemAttributes":{}},{"type":"ToMap","name":"map_page_post_frequency","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_posts_impressions":"@{evalJson(item, '$.page_posts_impressions_frequency_distribution_value')}","dimensionId":"frequency_@{evalJson(item, '$.page_posts_impressions_frequency_distribution_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_page_posts","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"InsertMapIntoDB","name":"save_page_posts","properties":{"tableName":"PagePost","batchSize":400,"fields":["pageId","dimensionId","extraction_date","page_posts_impressions","page_posts_impressions_unique","page_posts_impressions_paid","page_posts_impressions_paid_unique","page_posts_impressions_organic","page_posts_impressions_organic_unique","page_posts_impressions_viral","page_posts_impressions_viral_unique"]},"outputs":[],"itemAttributes":{}},{"type":"JsonToMap","name":"map_page_posts","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","pageId":"@{item.attributes.pageId}"},"excludes":["page_posts_impressions_frequency_distribution"]},"outputs":[{"name":"success","destination":"save_page_posts","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"MergeJsonArrays","name":"merge_reactions","properties":{"split":true,"mainArray":"@{evalJson(item, '$.data[?(@.name==\\'page_actions_post_reactions_like_total\\')].values[*].end_time')}","itemExpression":"@{listItem(evalJson(array.toString(), '$[?(@.end_time==\\'' + mainArray.get(index) + '\\')].value'),0)}","arrays":{"page_actions_post_reactions_like_total":"@{evalJson(item, '$.data[?(@.name==\\'page_actions_post_reactions_like_total\\')].values[*]')}","page_actions_post_reactions_love_total":"@{evalJson(item, '$.data[?(@.name==\\'page_actions_post_reactions_love_total\\')].values[*]')}","page_actions_post_reactions_wow_total":"@{evalJson(item, '$.data[?(@.name==\\'page_actions_post_reactions_wow_total\\')].values[*]')}","page_actions_post_reactions_haha_total":"@{evalJson(item, '$.data[?(@.name==\\'page_actions_post_reactions_haha_total\\')].values[*]')}","page_actions_post_reactions_sorry_total":"@{evalJson(item, '$.data[?(@.name==\\'page_actions_post_reactions_sorry_total\\')].values[*]')}","page_actions_post_reactions_anger_total":"@{evalJson(item, '$.data[?(@.name==\\'page_actions_post_reactions_anger_total\\')].values[*]')}"},"additionalJsonProperties":{"extraction_date":"@{evalJson(item, '$.data[?(@.name==\\'page_actions_post_reactions_like_total\\')].values[' + index + '].end_time')[0]}"}},"outputs":[{"name":"success","destination":"map_reactions"}],"itemAttributes":{}},{"type":"JsonToMap","name":"map_reactions","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","pageId":"@{item.attributes.pageId}","page_total_reactions":"@{evalJson(item, '$.page_actions_post_reactions_like_total', 0L) + evalJson(item, '$.page_actions_post_reactions_love_total', 0L) + evalJson(item, '$.page_actions_post_reactions_wow_total', 0L) + evalJson(item, '$.page_actions_post_reactions_haha_total', 0L) + evalJson(item, '$.page_actions_post_reactions_sorry_total', 0L) + evalJson(item, '$.page_actions_post_reactions_anger_total', 0L)}"}},"outputs":[{"name":"success","destination":"save_reactions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"InsertMapIntoDB","name":"save_reactions","properties":{"tableName":"PageReactions","batchSize":400,"fields":["pageId","dimensionId","extraction_date","page_actions_post_reactions_like_total","page_actions_post_reactions_love_total","page_actions_post_reactions_wow_total","page_actions_post_reactions_haha_total","page_actions_post_reactions_sorry_total","page_actions_post_reactions_anger_total","page_total_reactions"]},"outputs":[],"itemAttributes":{}},{"type":"MergeJsonArrays","name":"merge_page_engagement","properties":{"split":true,"mainArray":"@{evalJson(item, '$.data[?(@.name==\\'page_engaged_users\\')].values[*].end_time')}","itemExpression":"@{listItem(evalJson(array.toString(), '$[?(@.end_time==\\'' + mainArray.get(index) + '\\')].value'),0)}","arrays":{"page_engaged_users":"@{evalJson(item, '$.data[?(@.name==\\'page_engaged_users\\')].values[*]')}","page_post_engagements":"@{evalJson(item, '$.data[?(@.name==\\'page_post_engagements\\')].values[*]')}","page_consumptions":"@{evalJson(item, '$.data[?(@.name==\\'page_consumptions\\')].values[*]')}","page_consumptions_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_consumptions_unique\\')].values[*]')}","page_places_checkin_total":"@{evalJson(item, '$.data[?(@.name==\\'page_places_checkin_total\\')].values[*]')}","page_places_checkin_total_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_places_checkin_total_unique\\')].values[*]')}","page_places_checkin_mobile":"@{evalJson(item, '$.data[?(@.name==\\'page_places_checkin_mobile\\')].values[*]')}","page_places_checkin_mobile_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_places_checkin_mobile_unique\\')].values[*]')}","page_negative_feedback":"@{evalJson(item, '$.data[?(@.name==\\'page_negative_feedback\\')].values[*]')}","page_negative_feedback_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_negative_feedback_unique\\')].values[*]')}","page_places_checkins_by_age_gender":"@{evalJson(item, '$.data[?(@.name==\\'page_places_checkins_by_age_gender\\')].values[*]')}","page_places_checkins_by_locale":"@{evalJson(item, '$.data[?(@.name==\\'page_places_checkins_by_locale\\')].values[*]')}","page_places_checkins_by_country":"@{evalJson(item, '$.data[?(@.name==\\'page_places_checkins_by_country\\')].values[*]')}","page_negative_feedback_by_type":"@{evalJson(item, '$.data[?(@.name==\\'page_negative_feedback_by_type\\')].values[*]')}","page_negative_feedback_by_type_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_negative_feedback_by_type_unique\\')].values[*]')}","page_positive_feedback_by_type":"@{evalJson(item, '$.data[?(@.name==\\'page_positive_feedback_by_type\\')].values[*]')}","page_positive_feedback_by_type_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_positive_feedback_by_type_unique\\')].values[*]')}","page_consumptions_by_consumption_type":"@{evalJson(item, '$.data[?(@.name==\\'page_consumptions_by_consumption_type\\')].values[*]')}","page_consumptions_by_consumption_type_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_consumptions_by_consumption_type_unique\\')].values[*]')}"},"additionalJsonProperties":{"extraction_date":"@{evalJson(item, '$.data[?(@.name==\\'page_engaged_users\\')].values[' + index + '].end_time')[0]}"}},"outputs":[{"name":"success","destination":"map_page_engagement"},{"name":"success","destination":"split_consumption_type"},{"name":"success","destination":"split_consumption_type_unique"},{"name":"success","destination":"split_negative_feedback"},{"name":"success","destination":"split_negative_feedback_unique"},{"name":"success","destination":"split_places_age"},{"name":"success","destination":"split_places_locale"},{"name":"success","destination":"split_places_country"},{"name":"success","destination":"split_positive_feedback_type"},{"name":"success","destination":"split_positive_feedback_unique"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_fan_adds_paid_nonpaid","properties":{"property":"page_fan_adds_by_paid_non_paid_unique"},"outputs":[{"name":"success","destination":"map_fan_adds_paid_nonpaid"}],"itemAttributes":{}},{"type":"ToMap","name":"map_fan_adds_paid_nonpaid","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_fan_adds_unique":"@{evalJson(item, '$.page_fan_adds_by_paid_non_paid_unique_value')}","dimensionId":"paid_nonpaid_type_@{evalJson(item, '$.page_fan_adds_by_paid_non_paid_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_fans","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_positive_feedback_unique","properties":{"property":"page_positive_feedback_by_type_unique"},"outputs":[{"name":"success","destination":"map_positive_feedback_unique"}],"itemAttributes":{}},{"type":"ToMap","name":"map_positive_feedback_unique","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_positive_feedback_unique":"@{evalJson(item, '$.page_positive_feedback_by_type_unique_value')}","dimensionId":"positive_feedback_type_@{evalJson(item, '$.page_positive_feedback_by_type_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_positive_feedback_type","properties":{"property":"page_positive_feedback_by_type"},"outputs":[{"name":"success","destination":"map_positive_feedback_type"}],"itemAttributes":{}},{"type":"ToMap","name":"map_positive_feedback_type","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_positive_feedback":"@{evalJson(item, '$.page_positive_feedback_by_type_value')}","dimensionId":"positive_feedback_type_@{evalJson(item, '$.page_positive_feedback_by_type_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_places_country","properties":{"property":"page_places_checkins_by_country"},"outputs":[{"name":"success","destination":"map_places_country"}],"itemAttributes":{}},{"type":"ToMap","name":"map_places_country","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_places_checkin_total":"@{evalJson(item, '$.page_places_checkins_by_country_value')}","dimensionId":"country_@{evalJson(item, '$.page_places_checkins_by_country_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"InsertMapIntoDB","name":"save_engagement","properties":{"tableName":"PageEngagement","batchSize":400,"fields":["pageId","extraction_date","dimensionId","page_engaged_users","page_consumptions","page_consumptions_unique","page_places_checkin_total","page_places_checkin_total_unique","page_places_checkin_mobile","page_places_checkin_mobile_unique","page_negative_feedback","page_negative_feedback_unique","page_positive_feedback_unique","page_positive_feedback","page_post_engagements"]},"outputs":[],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_places_locale","properties":{"property":"page_places_checkins_by_locale"},"outputs":[{"name":"success","destination":"map_places_locale"}],"itemAttributes":{}},{"type":"ToMap","name":"map_places_locale","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_places_checkin_total":"@{evalJson(item, '$.page_places_checkins_by_locale_value')}","dimensionId":"locale_@{evalJson(item, '$.page_places_checkins_by_locale_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_places_age","properties":{"property":"page_places_checkins_by_age_gender"},"outputs":[{"name":"success","destination":"map_places_age"}],"itemAttributes":{}},{"type":"ToMap","name":"map_places_age","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_places_checkin_total":"@{evalJson(item, '$.page_places_checkins_by_age_gender_value')}","dimensionId":"gender_age_@{evalJson(item, '$.page_places_checkins_by_age_gender_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_negative_feedback_unique","properties":{"property":"page_negative_feedback_by_type_unique"},"outputs":[{"name":"success","destination":"map_negative_feedback_unique"}],"itemAttributes":{}},{"type":"ToMap","name":"map_negative_feedback_unique","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_negative_feedback_unique":"@{evalJson(item, '$.page_negative_feedback_by_type_unique_value')}","dimensionId":"negative_feedback_type_@{evalJson(item, '$.page_negative_feedback_by_type_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_negative_feedback","properties":{"property":"page_negative_feedback_by_type"},"outputs":[{"name":"success","destination":"map_negative_feedback"}],"itemAttributes":{}},{"type":"ToMap","name":"map_negative_feedback","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_negative_feedback":"@{evalJson(item, '$.page_negative_feedback_by_type_value')}","dimensionId":"negative_feedback_type_@{evalJson(item, '$.page_negative_feedback_by_type_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_consumption_type_unique","properties":{"property":"page_consumptions_by_consumption_type_unique"},"outputs":[{"name":"success","destination":"map_consumption_type_unique"}],"itemAttributes":{}},{"type":"ToMap","name":"map_consumption_type_unique","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_consumptions_unique":"@{evalJson(item, '$.page_consumptions_by_consumption_type_unique_value')}","dimensionId":"consumption_type_@{evalJson(item, '$.page_consumptions_by_consumption_type_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_consumption_type","properties":{"property":"page_consumptions_by_consumption_type"},"outputs":[{"name":"success","destination":"map_consumption_type"}],"itemAttributes":{}},{"type":"ToMap","name":"map_consumption_type","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_consumptions":"@{evalJson(item, '$.page_consumptions_by_consumption_type_value')}","dimensionId":"consumption_type_@{evalJson(item, '$.page_consumptions_by_consumption_type_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"JsonToMap","name":"map_page_engagement","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","pageId":"@{item.attributes.pageId}","page_positive_feedback":"@{toLong(evalJson(item, '$.page_positive_feedback_by_type.like'), 0L) + toLong(evalJson(item, '$.page_positive_feedback_by_type.comment', 0L)) + toLong(evalJson(item, '$.page_positive_feedback_by_type.link', 0L)) + toLong(evalJson(item, '$.page_positive_feedback_by_type.answer', 0L)) + toLong(evalJson(item, '$.page_positive_feedback_by_type.claim', 0L)) + toLong(evalJson(item, '$.page_positive_feedback_by_type.rsvp', 0L))}","page_positive_feedback_unique":"@{toLong(evalJson(item, '$.page_positive_feedback_by_type_unique.like'), 0L) + toLong(evalJson(item, '$.page_positive_feedback_by_type_unique.comment', 0L)) + toLong(evalJson(item, '$.page_positive_feedback_by_type_unique.link', 0L)) + toLong(evalJson(item, '$.page_positive_feedback_by_type_unique.answer', 0L)) + toLong(evalJson(item, '$.page_positive_feedback_by_type_unique.claim', 0L)) + toLong(evalJson(item, '$.page_positive_feedback_by_type_unique.rsvp', 0L))}"},"excludes":["page_places_checkins_by_age_gender","page_places_checkins_by_locale","page_places_checkins_by_country","page_negative_feedback_by_type","page_negative_feedback_by_type_unique","page_consumptions_by_consumption_type","page_consumptions_by_consumption_type_unique","page_positive_feedback_by_type_unique","page_positive_feedback_by_type"]},"outputs":[{"name":"success","destination":"save_engagement","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"MergeJsonArrays","name":"merge_page_impressions","properties":{"split":true,"mainArray":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions\\')].values[*].end_time')}","itemExpression":"@{listItem(evalJson(array.toString(), '$[?(@.end_time==\\'' + mainArray.get(index) + '\\')].value'),0)}","arrays":{"page_impressions":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions\\')].values[*]')}","page_impressions_organic":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_organic\\')].values[*]')}","page_impressions_organic_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_organic_unique\\')].values[*]')}","page_impressions_paid":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_paid\\')].values[*]')}","page_impressions_paid_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_paid_unique\\')].values[*]')}","page_impressions_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_unique\\')].values[*]')}","page_impressions_viral":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_viral\\')].values[*]')}","page_impressions_viral_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_viral_unique\\')].values[*]')}","page_impressions_by_story_type":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_by_story_type\\')].values[*]')}","page_impressions_by_story_type_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_by_story_type_unique\\')].values[*]')}","page_impressions_by_city_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_by_city_unique\\')].values[*]')}","page_impressions_by_country_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_by_country_unique\\')].values[*]')}","page_impressions_by_age_gender_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_by_age_gender_unique\\')].values[*]')}","page_impressions_frequency_distribution":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_frequency_distribution\\')].values[*]')}","page_impressions_by_locale_unique":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_by_locale_unique\\')].values[*]')}","page_impressions_viral_frequency_distribution":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions_viral_frequency_distribution\\')].values[*]')}"},"additionalJsonProperties":{"extraction_date":"@{evalJson(item, '$.data[?(@.name==\\'page_impressions\\')].values[' + index + '].end_time')[0]}"}},"outputs":[{"name":"success","destination":"map_page_impressions"},{"name":"success","destination":"split_country"},{"name":"success","destination":"split_impression_city"},{"name":"success","destination":"split_impression_viral_frequency"},{"name":"success","destination":"split_impression_age"},{"name":"success","destination":"split_story_type"},{"name":"success","destination":"split_impression_type_unique"},{"name":"success","destination":"split_impressions_locale"},{"name":"success","destination":"split_impressions_frequency"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_impressions_frequency","properties":{"property":"page_impressions_frequency_distribution"},"outputs":[{"name":"success","destination":"map_impressions_frequency"}],"itemAttributes":{}},{"type":"ToMap","name":"map_impressions_frequency","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_impressions":"@{evalJson(item, '$.page_impressions_frequency_distribution_value')}","dimensionId":"frequency_@{evalJson(item, '$.page_impressions_frequency_distribution_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_impressions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_impressions_locale","properties":{"property":"page_impressions_by_locale_unique"},"outputs":[{"name":"success","destination":"map_impressions_locale"}],"itemAttributes":{}},{"type":"ToMap","name":"map_impressions_locale","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_impressions_unique":"@{evalJson(item, '$.page_impressions_by_locale_unique_value')}","dimensionId":"locale_@{evalJson(item, '$.page_impressions_by_locale_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_impressions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_impression_type_unique","properties":{"property":"page_impressions_by_story_type_unique"},"outputs":[{"name":"success","destination":"map_impression_type_unique"}],"itemAttributes":{}},{"type":"ToMap","name":"map_impression_type_unique","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_impressions_unique":"@{evalJson(item, '$.page_impressions_by_story_type_unique_value')}","dimensionId":"story_type_@{evalJson(item, '$.page_impressions_by_story_type_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_impressions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"InsertMapIntoDB","name":"save_impressions","properties":{"tableName":"PageImpressions","batchSize":400,"fields":["pageId","extraction_date","dimensionId","page_impressions","page_impressions_organic","page_impressions_organic_unique","page_impressions_paid","page_impressions_paid_unique","page_impressions_unique","page_impressions_viral","page_impressions_viral_unique"]},"outputs":[],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_story_type","properties":{"property":"page_impressions_by_story_type"},"outputs":[{"name":"success","destination":"map_impression_story_type"}],"itemAttributes":{}},{"type":"ToMap","name":"map_impression_story_type","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_impressions":"@{evalJson(item, '$.page_impressions_by_story_type_value')}","dimensionId":"story_type_@{evalJson(item, '$.page_impressions_by_story_type_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_impressions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_impression_age","properties":{"property":"page_impressions_by_age_gender_unique"},"outputs":[{"name":"success","destination":"map_impression_age"}],"itemAttributes":{}},{"type":"ToMap","name":"map_impression_age","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_impressions_unique":"@{evalJson(item, '$.page_impressions_by_age_gender_unique_value')}","dimensionId":"gender_age_@{evalJson(item, '$.page_impressions_by_age_gender_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_impressions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_impression_viral_frequency","properties":{"property":"page_impressions_viral_frequency_distribution"},"outputs":[{"name":"success","destination":"map_viral_frequency"}],"itemAttributes":{}},{"type":"ToMap","name":"map_viral_frequency","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_impressions_viral":"@{evalJson(item, '$.page_impressions_viral_frequency_distribution_value')}","dimensionId":"frequency_@{evalJson(item, '$.page_impressions_viral_frequency_distribution_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_impressions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_impression_city","properties":{"property":"page_impressions_by_city_unique"},"outputs":[{"name":"success","destination":"map_impression_city"}],"itemAttributes":{}},{"type":"ToMap","name":"map_impression_city","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_impressions_unique":"@{evalJson(item, '$.page_impressions_by_city_unique_value')}","dimensionId":"city_@{evalJson(item, '$.page_impressions_by_city_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_impressions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_country","properties":{"property":"page_impressions_by_country_unique"},"outputs":[{"name":"success","destination":"map_impression_by_country"}],"itemAttributes":{}},{"type":"ToMap","name":"map_impression_by_country","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_impressions_unique":"@{evalJson(item, '$.page_impressions_by_country_unique_value')}","dimensionId":"country_@{evalJson(item, '$.page_impressions_by_country_unique_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_impressions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"JsonToMap","name":"map_page_impressions","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","pageId":"@{item.attributes.pageId}"},"excludes":["page_impressions_viral_frequency_distribution","page_impressions_frequency_distribution","page_impressions_by_age_gender_unique","page_impressions_by_locale_unique","page_impressions_by_country_unique","page_impressions_by_city_unique","page_impressions_by_story_type_unique","page_impressions_by_story_type"]},"outputs":[{"name":"success","destination":"save_impressions","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"MergeJsonArrays","name":"merge_stories_metrics","properties":{"split":true,"mainArray":"@{evalJson(item, '$.data[?(@.name==\\'page_content_activity\\')].values[*].end_time')}","itemExpression":"@{listItem(evalJson(array.toString(), '$[?(@.end_time==\\'' + mainArray.get(index) + '\\')].value'),0)}","arrays":{"page_stories":"@{evalJson(item, '$.data[?(@.name==\\'page_content_activity\\')].values[*]')}","page_content_activity_by_action_type":"@{evalJson(item, '$.data[?(@.name==\\'page_content_activity_by_action_type\\')].values[*]')}"},"additionalJsonProperties":{"extraction_date":"@{evalJson(item, '$.data[?(@.name==\\'page_content_activity\\')].values[' + index + '].end_time')[0]}"}},"outputs":[{"name":"success","destination":"split_story_types"},{"name":"success","destination":"map_stories"}],"itemAttributes":{}},{"type":"JsonToMap","name":"map_stories","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","pageId":"@{item.attributes.pageId}"},"excludes":["page_content_activity_by_action_type"]},"outputs":[{"name":"success","destination":"save_stories","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}},{"type":"InsertMapIntoDB","name":"save_stories","properties":{"tableName":"PageStories","batchSize":400,"fields":["pageId","extraction_date","dimensionId","page_stories","page_story_adds"]},"outputs":[],"itemAttributes":{}},{"type":"SplitJsonByProperty","name":"split_story_types","properties":{"property":"page_content_activity_by_action_type"},"outputs":[{"name":"success","destination":"map_story_type_metrics"}],"itemAttributes":{}},{"type":"ToMap","name":"map_story_type_metrics","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').minusDays(1)}","page_stories":"@{evalJson(item, '$.page_content_activity_by_action_type_value')}","dimensionId":"story_type_@{evalJson(item, '$.page_content_activity_by_action_type_key')}","pageId":"@{item.attributes.pageId}"}},"outputs":[{"name":"success","destination":"save_stories","condition":"@{item.content.extraction_date < item.attributes.until.toLocalDate().plusDays(1).atStartOfDay() && item.content.extraction_date < now().toLocalDate().plusDays(1).atStartOfDay()}"}],"itemAttributes":{}}],"excludes":["split_fans_city","split_impression_city"],"generalSteps":[]},"extractor":{"id":0,"timePeriod":0,"active":false,"errorCounter":0},"connectorCredentials":{"id":0,"organizationId":38,"datasourceId":1023896,"refreshToken":"EAAGuoVILSX4BAJrDwBm53SeVnzTZCZB1I21jcF3ieHWzxmt52mRoR3i9HHiXahP9ZAW5ZB15UDGZCpOK5ZBWQMRiC8e3LOUivMBc8ZCMcyX3DkOrsVla5s10Yg3Kn3qZClYmCtihB7BUTcTKxuZAKVvXaiJBgHGjHHBmfhHgcWcP4FgZDZD","datamart":"localhost","config":{"properties":{"pageId":"+ExoplatformTribe","domain":"mettrr","customFields":[{"id":360001124611,"title":"3rd Line Tech Support (UK) Type of Change/Request"},{"id":360001486852,"title":"3rd Line Adwords management Type of Change/Request"},{"id":360001486872,"title":"3rd Line Product support Type of Change/Request"},{"id":360001063512,"title":"2nd Line Legacy CWT Type of Change/Request"},{"id":360002165852,"title":"Mark as Spam"},{"id":360001063532,"title":"3rd Line Accounts and Admin (UK) Type of Change/Request"},{"id":360001062512,"title":"2nd Line CWT Type of Change/Request"},{"id":360001123991,"title":"1st Line Type of Change/Request"},{"id":360001124771,"title":"3rd Line Content (UK) Type of Change/Request"},{"id":360001227172,"title":"Country"},{"id":360001124011,"title":"2nd Line CTT Type of Change/Request"},{"id":360001227992,"title":"Phone Number - Only from form submission"}],"clientCustomerIds":["8049594734"],"reports":["ACCOUNT_PERFORMANCE_REPORT_Normal"]},"to":[],"oauthAccessTokenSecret":"oLZCb0LjGWAmmTONV8ciiz9f6ng488dncQps2h1eo2s2D"}}}