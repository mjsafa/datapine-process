{"processDefinition":{"name":"twitter-ads","steps":[{"type":"TwitterConnector","name":"twitterAccounts","properties":{"resourceURL":"https://ads-api.twitter.com/4/accounts"},"outputs":[{"name":"success","destination":"clean_accounts","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_accounts","properties":{"tableName":"AdsAccounts"},"outputs":[{"name":"success","destination":"splitAccounts","condition":null}],"itemAttributes":null,"extendsStep":null},{"type":"SplitJsonArray","name":"splitAccounts","properties":{"propertyJsonArray":"@{evalJson(item, '$.data')}"},"outputs":[{"name":"success","destination":"account_intervals","condition":null},{"name":"success","destination":"account_to_map","condition":null},{"name":"success","destination":"clean_instruments","condition":null},{"name":"success","destination":"clean_promoted_tweets","condition":null}],"itemAttributes":{"accountId":"@{evalJson(item, '$.id')}","timezone":"@{evalJson(item, '$.timezone')}"},"extendsStep":null},{"type":"JsonToMap","name":"account_to_map","properties":{"mappings":{"created_at":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updated_at":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"}},"outputs":[{"name":"success","destination":"save_accounts","condition":null}],"itemAttributes":null,"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_accounts","properties":{"tableName":"AdsAccounts","batchSize":200,"fields":["business_name","deleted","salt","updated_at","approval_status","timezone","name","created_at","id","business_id","timezone_switch_at","industry_type"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"TwitterConnector","name":"funding_instruments","properties":{"resourceURL":"https://ads-api.twitter.com/4/accounts/@{item.attributes.accountId}/funding_instruments"},"outputs":[{"name":"success","destination":"split_instruments","condition":null}],"itemAttributes":{"entity":"FUNDING_INSTRUMENT","metricGroups":"ENGAGEMENT,BILLING"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_instruments","properties":{"tables":["AdsFundingInstruments","AdsGroups","AdsCampaigns"],"predicates":[{"field":"account_id","operator":"=","value":"@{item.attributes.accountId}"}]},"outputs":[{"name":"success","destination":"funding_instruments","condition":null},{"name":"success","destination":"line_items","condition":null},{"name":"success","destination":"campaigns","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_instruments","properties":{"propertyJsonArray":"@{evalJson(item, '$.data')}"},"outputs":[{"name":"success","destination":"map_instruments","condition":null}],"itemAttributes":null,"extendsStep":null},{"type":"JsonToMap","name":"map_instruments","properties":{"mappings":{"credit_limit":"@{evalJson(item, '$.credit_limit_local_micro') != null ? evalJson(item, '$.credit_limit_local_micro')/1000000.0f : null}","credit_remaining":"@{evalJson(item, '$.credit_remaining_local_micro') != null ? evalJson(item, '$.credit_remaining_local_micro')/1000000.0f : null}","funding_status":"@{evalJson(item, '$.entity_status')}","funded_amount":"@{evalJson(item, '$.funded_amount_local_micro') != null ? evalJson(item, '$.funded_amount_local_micro')/1000000f : null}","created_at":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updated_at":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","start_time":"@{toDateTime(evalJson(item, '$.start_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","end_time":"@{toDateTime(evalJson(item, '$.end_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"},"excludes":["reasons_not_able_to_fund","credit_limit_local_micro","credit_remaining_local_micro","entity_status","funded_amount_local_micro"]},"outputs":[{"name":"success","destination":"save_instruments","condition":null}],"itemAttributes":null,"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_instruments","properties":{"tableName":"AdsFundingInstruments","batchSize":200,"fields":["credit_remaining","credit_limit","end_time","created_at","description","able_to_fund","type","start_time","account_id","deleted","funded_amount","updated_at","currency","funding_status","id","io_header"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"TwitterConnector","name":"line_items","properties":{"resourceURL":"https://ads-api.twitter.com/4/accounts/@{item.attributes.accountId}/line_items"},"outputs":[{"name":"success","destination":"split_line_items","condition":null}],"itemAttributes":{"entity":"LINE_ITEM","metricGroups":"ENGAGEMENT,BILLING"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_line_items","properties":{"propertyJsonArray":"@{evalJson(item, '$.data')}"},"outputs":[{"name":"success","destination":"map_line_items","condition":null}],"itemAttributes":null,"extendsStep":null},{"type":"JsonToMap","name":"map_line_items","properties":{"mappings":{"created_at":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updated_at":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","end_time":"@{toDateTime(evalJson(item, '$.end_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","bid_amount":"@{evalJson(item, '$.bid_amount_local_micro') != null ? evalJson(item, '$.bid_amount_local_micro')/1000000.0f : null}","adgroup_status":"@{evalJson(item, '$.entity_status')}","target_cpa":"@{evalJson(item, '$.target_cpa_local_micro') != null ? evalJson(item, '$.target_cpa_local_micro')/1000000.0f : null}","total_budget":"@{evalJson(item, '$.total_budget_amount_local_micro') != null ? evalJson(item, '$.total_budget_amount_local_micro')/1000000.0f : null}","categories":"@{joinToString(evalJson(item, '$.categories'), ',')}","placements":"@{joinToString(evalJson(item, '$.placements'), ',')}","tracking_tags":"@{joinToString(evalJson(item, '$.tracking_tags'), ',')}","start_time":"@{toDateTime(evalJson(item, '$.start_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"},"excludes":["bid_amount_local_micro","entity_status","target_cpa_local_micro","total_budget_amount_local_micro"]},"outputs":[{"name":"success","destination":"save_line_items","condition":null}],"itemAttributes":null,"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_line_items","properties":{"tableName":"AdsGroups","batchSize":200,"fields":["target_cpa","created_at","bid_type","primary_web_event_tag","objective","charge_by","advertiser_user_id","updated_at","optimization","currency","campaign_id","id","advertiser_domain","automatically_select_bid","end_time","creative_source","include_sentiment","bid_amount","total_budget","bid_unit","start_time","account_id","deleted","product_type","name","adgroup_status","categories","placements","tracking_tags"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"TwitterConnector","name":"promoted_tweets","properties":{"resourceURL":"https://ads-api.twitter.com/4/accounts/@{item.attributes.accountId}/promoted_tweets","requestParams":{"with_deleted":true}},"outputs":[{"name":"success","destination":"split_20_entities","condition":null},{"name":"success","destination":"split_promoted_100","condition":null},{"name":"success","destination":"split_promoted_tweets","condition":null}],"itemAttributes":{"entity":"PROMOTED_TWEET","metricGroups":"ENGAGEMENT,BILLING"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_promoted_100","properties":{"propertyJsonArray":"@{evalJson(item, '$.data')}","batchSize":100},"outputs":[{"name":"success","destination":"get_tweets","condition":null}],"itemAttributes":{"organicIds":"@{joinToString(evalJson(item, '$[*].tweet_id'), ',')}","promotedTweets":"@{item.content}"},"extendsStep":null},{"type":"TwitterConnector","name":"get_tweets","properties":{"resourceURL":"https://api.twitter.com/1.1/statuses/lookup.json","requestParams":{"id":"@{item.attributes.organicIds}"},"responseIsArray":true},"outputs":[{"name":"success","destination":"split_tweets","condition":null},{"name":"success","destination":"select_existing_tweets","condition":null}],"itemAttributes":{"organicTweets":"@{item.content}"},"extendsStep":null},{"type":"DbSelect","name":"select_existing_tweets","properties":{"tableName":"OrganicTweets","fields":["id"],"batchSize":0,"passIfNotFound":true,"predicates":[{"field":"type","value":"PROMOTED_ORGANIC","operator":"="}]},"outputs":[{"name":"success","destination":"existing_tweet_ids_to_json","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToJson","name":"existing_tweet_ids_to_json","properties":{},"outputs":[{"name":"success","destination":"split_organic_tweets","condition":null}],"itemAttributes":{"existingIds":"@{evalJson(item.content, '$[*].id')}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_organic_tweets","properties":{"array":"@{evalJson(item.attributes.organicTweets, '$[*]')}"},"outputs":[{"name":"success","destination":"map_organic_tweets","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_organic_tweets","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","retweet_id":"@{asString(evalJson(item, '$.retweeted_status.id'))}","reply_to_id":"@{asString(evalJson(item, '$.in_reply_to_status_id_str'))}","user_id":"@{asString(evalJson(item, '$.user.id'))}","text":"@{evalJson(item, '$.full_text')}","created_at":"@{toDateTime(evalJson(item, '$.created_at'), 'E MMM dd HH:mm:ss Z yyyy')}","NumericId":"@{evalJson(item, '$.id')}","type":"PROMOTED_ORGANIC","origin":"@{evalJson(item, '$.in_reply_to_status_id_str') != null ? 'Reply' : (evalJson(item, '$.retweeted_status') != null ? 'Retweet' : 'Normal')}","accountId":"@{item.attributes.accountId}"}},"outputs":[{"name":"success","destination":"save_tweets","condition":"@{item.attributes.?existingIds == null || (!item.attributes.existingIds.contains(item.content.id.toString()))}"}],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_tweets","properties":{"propertyJsonArray":"@{evalJson(item.attributes.promotedTweets, '$[*]')}"},"outputs":[{"name":"success","destination":"map_tweet","condition":null}],"itemAttributes":{"organicId":"@{evalJson(item, '$.tweet_id')}"},"extendsStep":null},{"type":"ToMap","name":"map_tweet","properties":{"mappings":{"text":"@{listItem(evalJson(item.attributes.organicTweets, '$[?(@.id == \\''+ item.attributes.organicId + '\\')].text'),0)}","retweet_id":"@{listItem(evalJson(item.attributes.organicTweets, '$[?(@.id == \\''+ item.attributes.organicId + '\\')].retweeted_status.id'),0)}","reply_to_id":"@{listItem(evalJson(item.attributes.organicTweets, '$[?(@.id == \\''+ item.attributes.organicId + '\\')].in_reply_to_status_id_str'),0)}","user_id":"@{listItem(evalJson(item.attributes.organicTweets, '$[?(@.id == \\''+ item.attributes.organicId + '\\')].user.id'),0)}","adgroup_id":"@{evalJson(item, '$.line_item_id')}","tweet_status":"@{evalJson(item, '$.entity_status')}","created_at":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updated_at":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","type":"PROMOTED","id":"@{evalJson(item, '$.id')}","accountId":"@{item.attributes.accountId}","origin":"Promoted","NumericId":"@{item.attributes.organicId}"}},"outputs":[{"name":"success","destination":"save_tweets","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_tweets","properties":{"tableName":"OrganicTweets","batchSize":200,"fields":["id","created_at","text","retweet_id","reply_to_id","user_id","adgroup_id","tweet_status","updated_at","type","NumericId","accountId","origin"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_promoted_tweets","properties":{"tableName":"OrganicTweets","predicates":[{"field":"type","value":"PROMOTED","operator":"="},{"field":"accountId","operator":"=","value":"@{item.attributes.accountId}"}]},"outputs":[{"name":"success","destination":"promoted_tweets","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_promoted_tweets","properties":{"propertyJsonArray":"@{evalJson(item, '$.data')}"},"outputs":[{"name":"success","destination":"map_promoted_tweets","condition":null},{"name":"success","destination":"get_tweet_data","condition":null}],"itemAttributes":null,"extendsStep":null},{"type":"TwitterConnector","name":"get_tweet_data","properties":{"resourceURL":"https://api.twitter.com/1.1/statuses/show/@{evalJson(item, '$.tweet_id')}","requestParams":{}},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"JsonToMap","name":"map_promoted_tweets","properties":{"mappings":{"organicTweetId":"@{toLong(evalJson(item, '$.tweet_id'))}","adgroup_id":"@{evalJson(item, '$.line_item_id')}","tweet_status":"@{evalJson(item, '$.entity_status')}","created_at":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updated_at":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"},"excludes":["tweet_id","line_item_id","entity_status"]},"outputs":[{"name":"success","destination":"save_promoted_tweets","condition":null}],"itemAttributes":null,"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_promoted_tweets","properties":{"tableName":"PromotedTweets","batchSize":200},"outputs":[],"itemAttributes":null,"extendsStep":null},{"type":"TwitterConnector","name":"campaigns","properties":{"resourceURL":"https://ads-api.twitter.com/4/accounts/@{item.attributes.accountId}/campaigns"},"outputs":[{"name":"success","destination":"split_campaigns","condition":null}],"itemAttributes":{"entity":"CAMPAIGN","metricGroups":"ENGAGEMENT,BILLING"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_campaigns","properties":{"propertyJsonArray":"@{evalJson(item, '$.data')}"},"outputs":[{"name":"success","destination":"map_campaigns","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"JsonToMap","name":"map_campaigns","properties":{"mappings":{"daily_budget":"@{evalJson(item, '$.daily_budget_amount_local_micro')/1000000.0f}","campaign_status":"@{evalJson(item, '$.entity_status')}","total_budget":"@{evalJson(item, '$.total_budget_amount_local_micro') != null ? evalJson(item, '$.total_budget_amount_local_micro')/1000000.0f: null}","created_at":"@{toDateTime(evalJson(item, '$.created_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","updated_at":"@{toDateTime(evalJson(item, '$.updated_at'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","end_time":"@{toDateTime(evalJson(item, '$.end_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","start_time":"@{toDateTime(evalJson(item, '$.start_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}"},"excludes":["reasons_not_servable","daily_budget_amount_local_micro","entity_status","total_budget_amount_local_micro"]},"outputs":[{"name":"success","destination":"save_campaigns","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_campaigns","properties":{"tableName":"AdsCampaigns","batchSize":200,"fields":["account_id","created_at","currency","daily_budget","deleted","duration_in_days","end_time","campaign_status","frequency_cap","funding_instrument_id","name","id","servable","standard_delivery","start_time","total_budget","updated_at"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_20_entities","properties":{"propertyJsonArray":"@{evalJson(item, '$.data')}","batchSize":20},"outputs":[{"name":"success","destination":"analytic_intervals","condition":null}],"itemAttributes":{"entityIds":"@{joinToString(evalJson(item, '$[*].id'), ',')}","entityIdsList":"@{evalJson(item, '$[*].id')}"},"extendsStep":null},{"type":null,"name":"analytic_intervals","properties":null,"outputs":[{"name":"success","destination":"entity_analytics","condition":null},{"name":"success","destination":"analytics_publisher_network","condition":null}],"itemAttributes":null,"extendsStep":"analytic_intervals"},{"type":"TwitterAnalytics","name":"analytics_publisher_network","properties":{"jobWaitTime":10000,"timezone":"@{item.attributes.timezone}","jobs":[{"accountId":"@{item.attributes.accountId}","start_time":"@{formatDate(item.attributes.from.plusDays(1), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","end_time":"@{formatDate(item.attributes.until.plusDays(1).plusHours(1), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","entity":"@{item.attributes.entity}","metric_groups":"@{item.attributes.metricGroups}","placement":"PUBLISHER_NETWORK","granularity":"DAY","entity_ids":"@{item.attributes.entityIds}"}]},"outputs":[{"name":"success","destination":"clean_entity_analytics","condition":null}],"itemAttributes":{"analyticsStartDate":"@{evalJson(item, '$.request.params.start_time')}","analyticsEndDate":"@{evalJson(item, '$.request.params.end_time')}","placement":"PUBLISHER_NETWORK"},"extendsStep":null},{"type":"TwitterAnalytics","name":"entity_analytics","properties":{"jobWaitTime":10000,"timezone":"@{item.attributes.timezone}","jobs":[{"accountId":"@{item.attributes.accountId}","start_time":"@{formatDate(item.attributes.from.plusDays(1), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","end_time":"@{formatDate(item.attributes.until.plusDays(1).plusHours(1), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","entity":"@{item.attributes.entity}","metric_groups":"@{item.attributes.metricGroups}","placement":"ALL_ON_TWITTER","granularity":"DAY","entity_ids":"@{item.attributes.entityIds}"}]},"outputs":[{"name":"success","destination":"clean_entity_analytics","condition":null}],"itemAttributes":{"analyticsStartDate":"@{evalJson(item, '$.request.params.start_time')}","analyticsEndDate":"@{evalJson(item, '$.request.params.end_time')}","placement":"ALL_ON_TWITTER"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_entity_analytics","properties":{"tableName":"Metrics","predicates":[{"field":"entityId","value":"@{item.attributes.entityIdsList}","operator":"in"},{"field":"extraction_date","start":"@{addTimeZoneOffset(toDateTime(item.attributes.analyticsStartDate, 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'' ), item.attributes.timezone)}","end":"@{addTimeZoneOffset(toDateTime(item.attributes.analyticsEndDate, 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'' ), item.attributes.timezone).minusMinutes(1)}","operator":"between"},{"field":"placement","value":"@{item.attributes.placement}","operator":"="}]},"outputs":[{"name":"success","destination":"split_analytics","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"GetIntervals","name":"account_intervals","properties":{},"outputs":[{"name":"success","destination":"account_analytics","condition":null}],"itemAttributes":null,"extendsStep":"analytic_intervals"},{"type":"TwitterAnalytics","name":"account_analytics","properties":{"timezone":"@{item.attributes.timezone}","jobWaitTime":10000,"jobs":[{"accountId":"@{item.attributes.accountId}","start_time":"@{formatDate(item.attributes.from.plusDays(1), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","end_time":"@{formatDate(item.attributes.until.plusDays(1).plusHours(1), 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'')}","entity":"ACCOUNT","metric_groups":"ENGAGEMENT","placement":"ALL_ON_TWITTER","granularity":"DAY"}]},"outputs":[{"name":"success","destination":"split_analytics","condition":null}],"itemAttributes":{"entity":"ACCOUNT","metricGroups":"ENGAGEMENT","analyticsStartDate":"@{evalJson(item, '$.request.params.start_time')}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_analytics","properties":{"propertyJsonArray":"@{evalJson(item, '$.data')}"},"outputs":[{"name":"success","destination":"process_analytics","condition":null}],"itemAttributes":null,"extendsStep":null},{"type":"MergeJsonArrays","name":"process_analytics","properties":{"arrays":{"engagements":"@{evalJson(item , '$.id_data[0].metrics.engagements')}","impressions":"@{evalJson(item , '$.id_data[0].metrics.impressions')}","retweets":"@{evalJson(item , '$.id_data[0].metrics.retweets')}","replies":"@{evalJson(item , '$.id_data[0].metrics.replies')}","likes":"@{evalJson(item , '$.id_data[0].metrics.likes')}","follows":"@{evalJson(item , '$.id_data[0].metrics.follows')}","unfollows":"@{evalJson(item , '$.id_data[0].metrics.unfollows')}","card_engagements":"@{evalJson(item , '$.id_data[0].metrics.card_engagements')}","total_clicks":"@{evalJson(item , '$.id_data[0].metrics.clicks')}","app_clicks":"@{evalJson(item , '$.id_data[0].metrics.app_clicks')}","url_clicks":"@{evalJson(item , '$.id_data[0].metrics.url_clicks')}","qualified_impressions":"@{evalJson(item , '$.id_data[0].metrics.qualified_impressions')}","billed_engagements":"@{evalJson(item , '$.id_data[0].metrics.billed_engagements')}","billed_charge":"@{evalJson(item , '$.id_data[0].metrics.billed_charge_local_micro')}","video_total_views":"@{evalJson(item , '$.id_data[0].metrics.video_total_views')}","video_views_25":"@{evalJson(item , '$.id_data[0].metrics.video_views_25')}","video_views_50":"@{evalJson(item , '$.id_data[0].metrics.video_views_50')}","video_views_75":"@{evalJson(item , '$.id_data[0].metrics.video_views_75')}","video_views_100":"@{evalJson(item , '$.id_data[0].metrics.video_views_100')}","video_cta_clicks":"@{evalJson(item , '$.id_data[0].metrics.video_cta_clicks')}","video_content_starts":"@{evalJson(item , '$.id_data[0].metrics.video_content_starts')}","video_mrc_views":"@{evalJson(item , '$.id_data[0].metrics.video_mrc_views')}","video_3s100pct_views":"@{evalJson(item , '$.id_data[0].metrics.video_3s100pct_views')}"},"additionalJsonProperties":{"extraction_date":"@{formatDate(addTimeZoneOffset(toDateTime(item.attributes.analyticsStartDate, 'yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'' ), item.attributes.timezone).plusDays(index), 'yyyy-MM-dd\\'T\\'HH:mm:ss')}","entityId":"@{evalJson(item, '$.id')}","entity":"Promoted"},"split":true},"outputs":[{"name":"success","destination":"analytics_to_map","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"JsonToMap","name":"analytics_to_map","properties":{"mappings":{"extraction_date":"@{toDateTime(evalJson(item, '$.extraction_date'), 'yyyy-MM-dd\\'T\\'HH:mm:ss')}","billed_charge":"@{evalJson(item, '$.billed_charge') != null ? evalJson(item, '$.billed_charge')/1000000.0f : null}","engagement_rate":"@{ evalJson(item, '$.impressions') > 0 ? (evalJson(item, '$.engagements')*1.0f) / (evalJson(item, '$.impressions')*1.0f) : 0}","placement":"@{item.attributes.placement}"}},"outputs":[{"name":"success","destination":"fix_null_to_zero","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"Modify","name":"fix_null_to_zero","properties":{"value":{"entity":"@{item.content.?entity}","placement":"@{item.content.?placement}","entityId":"@{item.content.?entityId}","extraction_date":"@{item.content.?extraction_date}","engagements":"@{item.content.?engagements != null ? item.content.?engagements : 0}","impressions":"@{item.content.?impressions != null ? item.content.?impressions : 0}","retweets":"@{item.content.?retweets != null ? item.content.?retweets : 0}","replies":"@{item.content.?replies != null ? item.content.?replies : 0}","likes":"@{item.content.?likes != null ? item.content.?likes : 0}","follows":"@{item.content.?follows != null ? item.content.?follows : 0}","card_engagements":"@{item.content.?card_engagements != null ? item.content.?card_engagements : 0}","total_clicks":"@{item.content.?total_clicks != null ? item.content.?total_clicks : 0}","app_clicks":"@{item.content.?app_clicks != null ? item.content.?app_clicks : 0}","url_clicks":"@{item.content.?url_clicks != null ? item.content.?url_clicks : 0}","qualified_impressions":"@{item.content.?qualified_impressions != null ? item.content.?qualified_impressions : 0}","billed_engagements":"@{item.content.?billed_engagements != null ? item.content.?billed_engagements : 0}","billed_charge":"@{item.content.?billed_charge != null ? item.content.?billed_charge : 0}","video_total_views":"@{item.content.?video_total_views != null ? item.content.?video_total_views : 0}","video_views_25":"@{item.content.?video_views_25 != null ? item.content.?video_views_25 : 0}","video_views_50":"@{item.content.?video_views_50 != null ? item.content.?video_views_50 : 0}","video_views_75":"@{item.content.?video_views_75 != null ? item.content.?video_views_75 : 0}","video_views_100":"@{item.content.?video_views_100 != null ? item.content.?video_views_100 : 0}","video_cta_clicks":"@{item.content.?video_cta_clicks != null ? item.content.?video_cta_clicks : 0}","video_content_starts":"@{item.content.?video_content_starts != null ? item.content.?video_content_starts : 0}","video_mrc_views":"@{item.content.?video_mrc_views != null ? item.content.?video_mrc_views : 0}","video_3s100pct_views":"@{item.content.?video_3s100pct_views != null ? item.content.?video_3s100pct_views : 0}","unfollows":"@{item.content.?unfollows != null ? item.content.?unfollows : 0}","engagement_rate":"@{item.content.?engagement_rate != null ? item.content.?engagement_rate : 0}"}},"outputs":[{"name":"success","destination":"save_analytics","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_analytics","properties":{"tableName":"Metrics","batchSize":200,"fields":["entity","entityId","extraction_date","engagements","impressions","retweets","replies","likes","follows","card_engagements","total_clicks","app_clicks","url_clicks","qualified_impressions","billed_engagements","billed_charge","video_total_views","video_views_25","video_views_50","video_views_75","video_views_100","video_cta_clicks","video_content_starts","video_mrc_views","video_3s100pct_views","unfollows","engagement_rate","placement"]},"outputs":[],"itemAttributes":{},"extendsStep":null}],"excludes":["account_intervals","get_tweet_data","save_promoted_tweets","split_promoted_tweets","funding_instruments","campaigns","clean_promoted_tweets"],"generalSteps":[{"type":"GetIntervals","name":"analytic_intervals","properties":{"totalMonths":6,"batchDays":90,"daysToExtract":3},"outputs":null,"itemAttributes":{"from":"@{item.content.from}","until":"@{item.content.until}"},"extendsStep":null}],"dependencies":null,"ignoreExceptionTypes":null,"exceptionIgnoreExpression":null},"extractor":{"id":0,"publicId":null,"lastExecution":null,"startExecution":null,"finishExecution":null,"queuedExecution":null,"nextExecution":null,"timeUnit":null,"timePeriod":0,"active":false,"status":null,"message":null,"errorCounter":0,"fullExtraction":true},"connectorCredentials":{"id":0,"organizationId":114,"datasourceId":8,"connectorType":"TWITTER","creationDate":null,"refreshToken":"880051095191638016-meSED4H7bxPTg7ZQAXcXyjfHmJ96XPp","datamart":"localhost","config":"{\"properties\":{\"pageId\":\"100230508074773910534\",\"domain\":\"mettrr\",\"customFields\":[{\"id\":360001124611,\"title\":\"3rd Line Tech Support (UK) Type of Change/Request\"},{\"id\":360001486852,\"title\":\"3rd Line Adwords management Type of Change/Request\"},{\"id\":360001486872,\"title\":\"3rd Line Product support Type of Change/Request\"},{\"id\":360001063512,\"title\":\"2nd Line Legacy CWT Type of Change/Request\"},{\"id\":360002165852,\"title\":\"Mark as Spam\"},{\"id\":360001063532,\"title\":\"3rd Line Accounts and Admin (UK) Type of Change/Request\"},{\"id\":360001062512,\"title\":\"2nd Line CWT Type of Change/Request\"},{\"id\":360001123991,\"title\":\"1st Line Type of Change/Request\"},{\"id\":360001124771,\"title\":\"3rd Line Content (UK) Type of Change/Request\"},{\"id\":360001227172,\"title\":\"Country\"},{\"id\":360001124011,\"title\":\"2nd Line CTT Type of Change/Request\"},{\"id\":360001227992,\"title\":\"Phone Number - Only from form submission\"}],\"clientCustomerIds\":[\"8670301477\"],\"reports\":[\"PLACEHOLDER_REPORT_Normal\",\"PLACEMENT_PERFORMANCE_REPORT_Normal\",\"PRODUCT_PARTITION_REPORT_Normal\",\"SEARCH_QUERY_PERFORMANCE_REPORT_Normal\",\"SHOPPING_PERFORMANCE_REPORT_ConversionSegmented\",\"SHOPPING_PERFORMANCE_REPORT_Normal\",\"TOP_CONTENT_PERFORMANCE_REPORT_Normal\",\"URL_PERFORMANCE_REPORT_ConversionSegmented\",\"URL_PERFORMANCE_REPORT_Normal\",\"USER_AD_DISTANCE_REPORT_Normal\",\"VIDEO_PERFORMANCE_REPORT_ConversionSegmented\",\"VIDEO_PERFORMANCE_REPORT_Normal\"]},\"to\":[],\"oauthAccessTokenSecret\":\"7udejygrdCFrtKbf1ffszimUx2BeuAIlG0seu8ADzG5mc\"}","extractor":null}}