{"processDefinition":{"name":"linked-in-v2","steps":[{"type":"ToMap","name":"map_total_update_stats","properties":{"mappings":{"shareCount":"@{evalJson(item, '$.totalShareStatistics.shareCount')}","clickCount":"@{evalJson(item, '$.totalShareStatistics.clickCount')}","engagement":"@{evalJson(item, '$.totalShareStatistics.engagement')}","likeCount":"@{evalJson(item, '$.totalShareStatistics.likeCount')}","impressionCount":"@{evalJson(item, '$.totalShareStatistics.impressionCount')}","uniqueCount":"@{evalJson(item, '$.totalShareStatistics.impressionCount')}","commentCount":"@{evalJson(item, '$.totalShareStatistics.commentCount')}","extraction_date":"@{epochToDate(evalJson(item, '$.timeRange.start'))}","companyId":"@{item.attributes.organizationId}","socialActions":"@{evalJson(item, '$.totalShareStatistics.shareCount') + evalJson(item, '$.totalShareStatistics.likeCount') + evalJson(item, '$.totalShareStatistics.commentCount')}"}},"outputs":[{"name":"success","destination":"save_total_update_stats","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_total_update_stats","properties":{"tableName":"HistoricalCompanyStats","batchSize":400,"fields":["extraction_date","companyId","impressionCount","engagement","uniqueCount","shareCount","clickCount","likeCount","commentCount","socialActions"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_company_stats","properties":{"tables":["FollowerRegion","FollowerFunction","FollowerIndustries","FollowerCompanySize","FollowerCountry","FollowerSeniority","FollowerEmployment"],"predicates":[{"field":"companyId","operator":"=","value":"@{item.attributes.organizationId}"},{"field":"extraction_date","operator":">=","value":"@{currentDate().atStartOfDay()}"}]},"outputs":[{"name":"success","destination":"get_company_followers_by_segment","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"GetIntervals","name":"update_stats_interval","properties":{"totalMonths":"@{config.totalMonths}","batchDays":"@{config.postsIntervalBatchDays}","daysToExtract":"@{config.partialDaysToExtract}"},"outputs":[{"name":"success","destination":"clean_update_stats","condition":null}],"itemAttributes":{"startDate":"@{item.content.from}","endDate":"@{item.content.until}"},"extendsStep":null},{"type":"LinkedInV2","name":"get_update_stats","properties":{"url":"https://api.linkedin.com/v2/organizationalEntityShareStatistics?shares=List(@{joinToString(encodeUrl(item.attributes.updateUrns), ',')})&timeIntervals=(timeRange:(start:@{epoch(item.attributes.startDate)},end:@{epoch(item.attributes.endDate)}),timeGranularityType:DAY)","params":{"q":"organizationalEntity","organizationalEntity":"@{item.attributes.companyUrn}","count":200}},"outputs":[{"name":"success","destination":"map_update_stats","condition":null}],"itemAttributes":{"updateId":"@{LINKEDIN.parseURN(evalJson(item, '$.share'))}"},"extendsStep":null},{"type":"ToMap","name":"map_update_stats","properties":{"mappings":{"shareCount":"@{evalJson(item, '$.totalShareStatistics.shareCount')}","clickCount":"@{evalJson(item, '$.totalShareStatistics.clickCount')}","engagement":"@{evalJson(item, '$.totalShareStatistics.engagement')}","likeCount":"@{evalJson(item, '$.totalShareStatistics.likeCount')}","impressionCount":"@{evalJson(item, '$.totalShareStatistics.impressionCount')}","commentCount":"@{evalJson(item, '$.totalShareStatistics.commentCount')}","extraction_date":"@{epochToDate(evalJson(item, '$.timeRange.start'))}","companyId":"@{item.attributes.organizationId}","updateKey":"@{item.attributes.updateId}","socialActions":"@{evalJson(item, '$.totalShareStatistics.shareCount') + evalJson(item, '$.totalShareStatistics.likeCount') + evalJson(item, '$.totalShareStatistics.commentCount')}"}},"outputs":[{"name":"success","destination":"save_update_stats","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_update_stats","properties":{"tableName":"HistoricalUpdateStats","batchSize":400,"fields":["extraction_date","companyId","updateKey","impressionCount","engagement","shareCount","clickCount","likeCount","commentCount","socialActions"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_update_stats","properties":{"tableName":"HistoricalUpdateStats","predicates":[{"field":"extraction_date","operator":">=","value":"@{item.attributes.startDate}"},{"field":"extraction_date","operator":"<=","value":"@{item.attributes.endDate}"},{"field":"companyId","operator":"=","value":"@{item.attributes.organizationId}"},{"field":"updateKey","operator":"IN","value":"@{item.attributes.updateIds}"}]},"outputs":[{"name":"success","destination":"get_update_stats","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_update","properties":{"tableName":"CompanyUpdates","batchSize":200,"fields":["updateKey","comment","updateType","timestamp","companyId","title","description","submittedUrl"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_companies","properties":{"tables":["Company"]},"outputs":[{"name":"success","destination":"get_managed_companies","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"LinkedInV2","name":"get_managed_companies","properties":{"url":"https://api.linkedin.com/v2/organizationalEntityAcls?q=roleAssignee","params":{"count":100}},"outputs":[{"name":"success","destination":"get_company_profile","condition":null},{"name":"success","destination":"clean_company_updates","condition":null},{"name":"success","destination":"company_update_stats_interval","condition":null},{"name":"success","destination":"followers_interval","condition":null},{"name":"success","destination":"clean_company_stats","condition":null},{"name":"success","destination":"page_stats_interval","condition":null}],"itemAttributes":{"organizationId":"@{LINKEDIN.parseURN(evalJson(item, '$.organizationalTarget'))}","companyUrn":"@{evalJson(item, '$.organizationalTarget')}"},"extendsStep":null},{"type":"GetIntervals","name":"page_stats_interval","properties":{"totalMonths":"@{config.totalMonths}","batchDays":90,"daysToExtract":"@{config.partialDaysToExtract}"},"outputs":[{"name":"success","destination":"clean_page_stats","condition":null}],"itemAttributes":{"startDate":"@{item.content.from}","endDate":"@{item.content.until}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_page_stats","properties":{"tableName":"PageStats","predicates":[{"field":"extraction_date","operator":">=","value":"@{item.attributes.startDate}"},{"field":"extraction_date","operator":"<=","value":"@{item.attributes.endDate}"},{"field":"companyId","operator":"=","value":"@{item.attributes.organizationId}"}]},"outputs":[{"name":"success","destination":"get_page_stats","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"LinkedInV2","name":"get_page_stats","properties":{"url":"https://api.linkedin.com/v2/organizationPageStatistics?timeIntervals=(timeRange:(start:@{epoch(item.attributes.startDate)},end:@{epoch(item.attributes.endDate)}),timeGranularityType:DAY)","params":{"q":"organization","organization":"@{item.attributes.companyUrn}","count":200}},"outputs":[{"name":"success","destination":"map_page_stats","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_page_stats","properties":{"mappings":{"careersPageBannerPromoClicks":"@{evalJson(item, '$.totalPageStatistics.clicks.careersPageClicks.careersPageBannerPromoClicks')}","careersPageEmployeesClicks":"@{evalJson(item, '$.totalPageStatistics.clicks.careersPageClicks.careersPageEmployeesClicks')}","careersPagePromoLinksClicks":"@{evalJson(item, '$.totalPageStatistics.clicks.careersPageClicks.careersPagePromoLinksClicks')}","careersPageJobsClicks":"@{evalJson(item, '$.totalPageStatistics.clicks.careersPageClicks.careersPageJobsClicks')}","mobileCareersPageEmployeesClicks":"@{evalJson(item, '$.totalPageStatistics.clicks.mobileCareersPageClicks.careersPageEmployeesClicks')}","mobileCareersPagePromoLinksClicks":"@{evalJson(item, '$.totalPageStatistics.clicks.mobileCareersPageClicks.careersPagePromoLinksClicks')}","mobileCareersPageJobsClicks":"@{evalJson(item, '$.totalPageStatistics.clicks.mobileCareersPageClicks.careersPageJobsClicks')}","mobileJobsPageViews":"@{evalJson(item, '$.totalPageStatistics.views.mobileJobsPageViews.pageViews')}","mobileJobsPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.mobileJobsPageViews.uniquePageViews')}","careersPageViews":"@{evalJson(item, '$.totalPageStatistics.views.careersPageViews.pageViews')}","careersPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.careersPageViews.uniquePageViews')}","mobileLifeAtPageViews":"@{evalJson(item, '$.totalPageStatistics.views.mobileLifeAtPageViews.pageViews')}","mobileLifeAtPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.mobileLifeAtPageViews.uniquePageViews')}","insightsPageViews":"@{evalJson(item, '$.totalPageStatistics.views.insightsPageViews.pageViews')}","insightsPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.insightsPageViews.uniquePageViews')}","allDesktopPageViews":"@{evalJson(item, '$.totalPageStatistics.views.allDesktopPageViews.pageViews')}","allDesktopPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.allDesktopPageViews.uniquePageViews')}","mobileAboutPageViews":"@{evalJson(item, '$.totalPageStatistics.views.mobileAboutPageViews.pageViews')}","mobileAboutPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.mobileAboutPageViews.uniquePageViews')}","allMobilePageViews":"@{evalJson(item, '$.totalPageStatistics.views.allMobilePageViews.pageViews')}","allMobilePageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.allMobilePageViews.uniquePageViews')}","desktopJobsPageViews":"@{evalJson(item, '$.totalPageStatistics.views.desktopJobsPageViews.pageViews')}","desktopJobsPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.desktopJobsPageViews.uniquePageViews')}","jobsPageViews":"@{evalJson(item, '$.totalPageStatistics.views.jobsPageViews.pageViews')}","jobsPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.jobsPageViews.uniquePageViews')}","peoplePageViews":"@{evalJson(item, '$.totalPageStatistics.views.peoplePageViews.pageViews')}","peoplePageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.peoplePageViews.uniquePageViews')}","desktopPeoplePageViews":"@{evalJson(item, '$.totalPageStatistics.views.desktopPeoplePageViews.pageViews')}","desktopPeoplePageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.desktopPeoplePageViews.uniquePageViews')}","aboutPageViews":"@{evalJson(item, '$.totalPageStatistics.views.aboutPageViews.pageViews')}","aboutPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.aboutPageViews.uniquePageViews')}","desktopAboutPageViews":"@{evalJson(item, '$.totalPageStatistics.views.desktopAboutPageViews.pageViews')}","desktopAboutPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.desktopAboutPageViews.uniquePageViews')}","overviewPageViews":"@{evalJson(item, '$.totalPageStatistics.views.overviewPageViews.pageViews')}","overviewPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.overviewPageViews.uniquePageViews')}","mobilePeoplePageViews":"@{evalJson(item, '$.totalPageStatistics.views.mobilePeoplePageViews.pageViews')}","mobilePeoplePageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.mobilePeoplePageViews.uniquePageViews')}","desktopInsightsPageViews":"@{evalJson(item, '$.totalPageStatistics.views.desktopInsightsPageViews.pageViews')}","desktopInsightsPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.desktopInsightsPageViews.uniquePageViews')}","desktopCareersPageViews":"@{evalJson(item, '$.totalPageStatistics.views.desktopCareersPageViews.pageViews')}","desktopCareersPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.desktopCareersPageViews.uniquePageViews')}","mobileOverviewPageViews":"@{evalJson(item, '$.totalPageStatistics.views.mobileOverviewPageViews.pageViews')}","mobileOverviewPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.mobileOverviewPageViews.uniquePageViews')}","lifeAtPageViews":"@{evalJson(item, '$.totalPageStatistics.views.lifeAtPageViews.pageViews')}","lifeAtPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.lifeAtPageViews.uniquePageViews')}","desktopOverviewPageViews":"@{evalJson(item, '$.totalPageStatistics.views.desktopOverviewPageViews.pageViews')}","desktopOverviewPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.desktopOverviewPageViews.uniquePageViews')}","desktopLifeAtPageViews":"@{evalJson(item, '$.totalPageStatistics.views.desktopLifeAtPageViews.pageViews')}","desktopLifeAtPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.desktopLifeAtPageViews.uniquePageViews')}","mobileCareersPageViews":"@{evalJson(item, '$.totalPageStatistics.views.mobileCareersPageViews.pageViews')}","mobileCareersPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.mobileCareersPageViews.uniquePageViews')}","allPageViews":"@{evalJson(item, '$.totalPageStatistics.views.allPageViews.pageViews')}","allPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.allPageViews.uniquePageViews')}","mobileInsightsPageViews":"@{evalJson(item, '$.totalPageStatistics.views.mobileInsightsPageViews.pageViews')}","mobileInsightsPageViewsUnique":"@{evalJson(item, '$.totalPageStatistics.views.mobileInsightsPageViews.uniquePageViews')}","extraction_date":"@{epochToDate(evalJson(item, '$.timeRange.start'))}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"save_page_stats","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_page_stats","properties":{"tableName":"PageStats","batchSize":400},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"GetIntervals","name":"followers_interval","properties":{"totalMonths":"@{config.totalMonths}","batchDays":"@{config.totalMonths  * 31}","daysToExtract":"@{config.partialDaysToExtract}"},"outputs":[{"name":"success","destination":"clean_historical_followers","condition":null}],"itemAttributes":{"startDate":"@{item.content.from}","endDate":"@{diffMillis(item.content.until, item.content.from) <  24 * 60 * 60 * 1000 ? item.content.from.plusDays(1) : item.content.until}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_historical_followers","properties":{"tableName":"HistoricalFollowerStats","predicates":[{"field":"extraction_date","operator":">=","value":"@{item.attributes.startDate}"},{"field":"extraction_date","operator":"<=","value":"@{item.attributes.endDate}"},{"field":"companyId","operator":"=","value":"@{item.attributes.organizationId}"}]},"outputs":[{"name":"success","destination":"get_historical_followers","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"LinkedInV2","name":"get_historical_followers","properties":{"url":"https://api.linkedin.com/v2/organizationalEntityFollowerStatistics?timeIntervals=(timeRange:(start:@{epoch(item.attributes.startDate)},end:@{epoch(item.attributes.endDate)}),timeGranularityType:DAY)","params":{"q":"organizationalEntity","organizationalEntity":"@{item.attributes.companyUrn}","count":200}},"outputs":[{"name":"success","destination":"map_historical_follower","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_historical_follower","properties":{"mappings":{"extraction_date":"@{epochToDate(evalJson(item, '$.timeRange.start'))}","organicFollowerAdds":"@{evalJson(item, '$.followerGains.organicFollowerGain')}","paidFollowerAdds":"@{evalJson(item, '$.followerGains.paidFollowerGain')}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"save_historical_follower","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_historical_follower","properties":{"tableName":"HistoricalFollowerStats","batchSize":400},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"LinkedInV2","name":"get_company_followers_by_segment","properties":{"url":"https://api.linkedin.com/v2/organizationalEntityFollowerStatistics?q=organizationalEntity&organizationalEntity=@{encodeUrl(item.attributes.companyUrn)}","params":{"count":100},"asArray":true},"outputs":[{"name":"success","destination":"split_followers_region","condition":null},{"name":"success","destination":"split_seniority","condition":null},{"name":"success","destination":"split_industry","condition":null},{"name":"success","destination":"split_staff_count","condition":null},{"name":"success","destination":"split_function","condition":null},{"name":"success","destination":"split_country","condition":null},{"name":"success","destination":"split_follower_eployee","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_follower_eployee","properties":{"array":"@{evalJson(item, '$[*].followerCountsByAssociationType[*]')}"},"outputs":[{"name":"success","destination":"map_follower_eployment","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_follower_eployment","properties":{"mappings":{"paidCount":"@{toInt(evalJson(item, '$.followerCounts.paidFollowerCount'))}","followers":"@{toInt(evalJson(item, '$.followerCounts.organicFollowerCount'))}","employmentStatus":"@{evalJson(item, '$.associationType') == 'EMPLOYEE' ? 'Employee' : 'NonEmployee'}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"save_follower_employment","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_follower_employment","properties":{"tableName":"FollowerEmployment","batchSize":200,"fields":["companyId","extraction_date","followers","paidCount","employmentStatus"]},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_country","properties":{"array":"@{evalJson(item, '$[*].followerCountsByCountry[*]')}"},"outputs":[{"name":"success","destination":"map_coutry","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_coutry","properties":{"mappings":{"paidCount":"@{toInt(evalJson(item, '$.followerCounts.paidFollowerCount'))}","count":"@{toInt(evalJson(item, '$.followerCounts.organicFollowerCount'))}","countryCode":"@{LINKEDIN.parseURN(evalJson(item, '$.country'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"save_follower_country","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_follower_country","properties":{"tableName":"FollowerCountry","batchSize":200},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_function","properties":{"array":"@{evalJson(item, '$[*].followerCountsByFunction[*]')}"},"outputs":[{"name":"success","destination":"map_follower_function","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_follower_function","properties":{"mappings":{"paidCount":"@{toInt(evalJson(item, '$.followerCounts.paidFollowerCount'))}","count":"@{toInt(evalJson(item, '$.followerCounts.organicFollowerCount'))}","function":"@{LINKEDIN.parseURN(evalJson(item, '$.function'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"save_follower_function","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_follower_function","properties":{"tableName":"FollowerFunction","batchSize":200},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_staff_count","properties":{"array":"@{evalJson(item, '$[*].followerCountsByStaffCountRange[*]')}"},"outputs":[{"name":"success","destination":"map_follower_staff_count","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_follower_staff_count","properties":{"mappings":{"paidCount":"@{toInt(evalJson(item, '$.followerCounts.paidFollowerCount'))}","count":"@{toInt(evalJson(item, '$.followerCounts.organicFollowerCount'))}","companySize":"@{StringUtils.replace(capitalizeFully(evalJson(item, '$.staffCountRange'), '_'), '_', ' ').replace('Size ', '')}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"save_follower_staffCount","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_follower_staffCount","properties":{"tableName":"FollowerCompanySize","batchSize":200},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_industry","properties":{"array":"@{evalJson(item, '$[*].followerCountsByIndustry[*]')}"},"outputs":[{"name":"success","destination":"map_followers_industry","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_followers_industry","properties":{"mappings":{"paidCount":"@{toInt(evalJson(item, '$.followerCounts.paidFollowerCount'))}","count":"@{toInt(evalJson(item, '$.followerCounts.organicFollowerCount'))}","industry":"@{LINKEDIN.parseURN(evalJson(item, '$.industry'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"save_follower_industry","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_follower_industry","properties":{"tableName":"FollowerIndustries","batchSize":200},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_seniority","properties":{"array":"@{evalJson(item, '$[*].followerCountsBySeniority[*]')}"},"outputs":[{"name":"success","destination":"map_follower_seniority","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_follower_seniority","properties":{"mappings":{"paidCount":"@{toInt(evalJson(item, '$.followerCounts.paidFollowerCount'))}","count":"@{toInt(evalJson(item, '$.followerCounts.organicFollowerCount'))}","seniority":"@{LINKEDIN.parseURN(evalJson(item, '$.seniority'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"save_follower_seniority","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_follower_seniority","properties":{"tableName":"FollowerSeniority","batchSize":200},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_followers_region","properties":{"array":"@{evalJson(item, '$[*].followerCountsByRegion[*]')}"},"outputs":[{"name":"success","destination":"map_followers_region","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_followers_region","properties":{"mappings":{"paidCount":"@{toInt(evalJson(item, '$.followerCounts.paidFollowerCount'))}","count":"@{toInt(evalJson(item, '$.followerCounts.organicFollowerCount'))}","region":"@{LINKEDIN.parseURN(evalJson(item, '$.region'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"save_follower_region","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_follower_region","properties":{"tableName":"FollowerRegion","batchSize":200},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"GetIntervals","name":"company_update_stats_interval","properties":{"totalMonths":"@{config.totalMonths}","batchDays":"@{config.totalMonths  * 31}","daysToExtract":"@{config.partialDaysToExtract}"},"outputs":[{"name":"success","destination":"clean_company_update_stats","condition":null}],"itemAttributes":{"startDate":"@{item.content.from}","endDate":"@{item.content.until}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_company_update_stats","properties":{"tableName":"HistoricalCompanyStats","predicates":[{"field":"extraction_date","operator":">=","value":"@{item.attributes.startDate}"},{"field":"extraction_date","operator":"<=","value":"@{item.attributes.endDate}"},{"field":"companyId","operator":"=","value":"@{item.attributes.organizationId}"}]},"outputs":[{"name":"success","destination":"get_company_update_stats","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"LinkedInV2","name":"get_company_update_stats","properties":{"url":"https://api.linkedin.com/v2/organizationalEntityShareStatistics?timeIntervals=(timeRange:(start:@{epoch(item.attributes.startDate)},end:@{epoch(item.attributes.endDate)}),timeGranularityType:DAY)","params":{"q":"organizationalEntity","organizationalEntity":"@{item.attributes.companyUrn}","count":200}},"outputs":[{"name":"success","destination":"map_total_update_stats","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_company_updates","properties":{"tableName":"CompanyUpdates","predicates":[{"field":"companyId","value":"@{item.attributes.organizationId}"}]},"outputs":[{"name":"success","destination":"get_comapny_updates","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"LinkedInV2","name":"get_comapny_updates","properties":{"url":"https://api.linkedin.com/v2/ugcPosts?q=authors&authors=List(@{encodeUrl(item.attributes.companyUrn)})","params":{"count":"@{config.postsBatchSize}"},"asArray":true},"outputs":[{"name":"success","destination":"update_stats_interval","condition":null},{"name":"success","destination":"split_company_updates","condition":null}],"itemAttributes":{"updateUrns":"@{evalJson(item, '$[?(@.id =~ /.*urn:li:share:.+/)].id')}","updateIds":"@{LINKEDIN.parseURNs(evalJson(item, '$[*].id'))}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_company_updates","properties":{"array":"@{evalJson(item, '$')}"},"outputs":[{"name":"success","destination":"map_update_content","condition":null}],"itemAttributes":{"updateId":"@{LINKEDIN.parseURN(evalJson(item, '$.id'))}","updateUrn":"@{evalJson(item, '$.id')}"},"extendsStep":null},{"type":"ToMap","name":"map_update_content","properties":{"mappings":{"visibility":"@{evalJson(item, '$.visibility[\\'com.linkedin.ugc.MemberNetworkVisibility\\']')}","updateKey":"@{LINKEDIN.parseURN(evalJson(item, '$.id'))}","status":"@{evalJson(item, '$.lifecycleState')}","updateType":"@{evalJson(item, '$.specificContent[\\'com.linkedin.ugc.ShareContent\\'].shareMediaCategory')}","comment":"@{evalJson(item, '$.specificContent[\\'com.linkedin.ugc.ShareContent\\'].shareCommentary.text')}","title":"@{evalJson(item, '$.specificContent[\\'com.linkedin.ugc.ShareContent\\'].media[0].title.text')}","description":"@{evalJson(item, '$.specificContent[\\'com.linkedin.ugc.ShareContent\\'].media[0].description.text')}","timestamp":"@{epochToDate(evalJson(item, '$.created.time'))}","companyId":"@{item.attributes.organizationId}","submittedUrl":"@{evalJson(item, '$.specificContent[\\'com.linkedin.ugc.ShareContent\\'].media[0].originalUrl')}"}},"outputs":[{"name":"success","destination":"save_update","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"LinkedInV2","name":"get_company_profile","properties":{"url":"https://api.linkedin.com/v2/organizations/@{item.attributes.organizationId}","params":{"count":100}},"outputs":[{"name":"success","destination":"map_company","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_company","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","name":"@{evalJson(item, '$.localizedName')}","employeeCountRange":"@{StringUtils.replace(StringUtils.replace(capitalizeFully(evalJson(item, '$.staffCountRange'), '_'), '_',' '),'Size ', '')}","companyType":"@{StringUtils.replace(capitalizeFully(evalJson(item, '$.organizationType'), '_'), '_',' ')}","status":"@{capitalizeFully(evalJson(item, '$.organizationStatus'), '_')}"}},"outputs":[{"name":"success","destination":"save_company","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_company","properties":{"tableName":"Company","fields":["id","name","employeeCountRange","companyType","status"]},"outputs":[],"itemAttributes":{},"extendsStep":null}],"excludes":["get_company_followers_by_segment","page_stats_interval","followers_interval","company_update_stats_interval","get_company_profile","update_stats_interval","split_company_updates"],"generalSteps":[],"dependencies":null,"ignoreExceptionTypes":null,"exceptionIgnoreExpression":null},"extractor":{"id":0,"publicId":null,"lastExecution":null,"startExecution":null,"finishExecution":null,"queuedExecution":null,"nextExecution":null,"timeUnit":null,"timePeriod":0,"active":false,"status":null,"message":null,"errorCounter":0,"fullExtraction":true},"connectorCredentials":{"id":0,"organizationId":35,"datasourceId":33627,"connectorType":"LINKEDIN","creationDate":null,"refreshToken":"AQXxQcVotI0IkvPWPwVSjzqxdGdInOLOeRurFoF6ZXi7aQ1VRgcWOualdSIh8UmnGVViztIEPIYW5CNv8oy41gbNPMkGYatbUcDGUQhyYh0LaLma44r-Mc3MaHnBFs4y7zvKagItpEIHKrdDMj2HUZDeaOFJd5qyIsONh4BTiVubPeraPwo3OdQr7Vdt87e2ysXH0WHKBix9stHgZI8KBXBaRKW3pIUvCLXlhu-p6sNwLNfM33h6xqIH97EzFSgB8joDyxhc3gX33ylz1UYRf2SYJ8gWb4B2Sih_aBMWxp8VdBSeAyXLrKKFVxsk4VYZF08pibyg9ifS0SaOAR0BwCSms70qvA","datamart":"localhost","config":"{\"properties\":{\"pageId\":\"100230508074773910534\",\"domain\":\"mettrr\",\"customFields\":[{\"id\":360001124611,\"title\":\"3rd Line Tech Support (UK) Type of Change/Request\"},{\"id\":360001486852,\"title\":\"3rd Line Adwords management Type of Change/Request\"},{\"id\":360001486872,\"title\":\"3rd Line Product support Type of Change/Request\"},{\"id\":360001063512,\"title\":\"2nd Line Legacy CWT Type of Change/Request\"},{\"id\":360002165852,\"title\":\"Mark as Spam\"},{\"id\":360001063532,\"title\":\"3rd Line Accounts and Admin (UK) Type of Change/Request\"},{\"id\":360001062512,\"title\":\"2nd Line CWT Type of Change/Request\"},{\"id\":360001123991,\"title\":\"1st Line Type of Change/Request\"},{\"id\":360001124771,\"title\":\"3rd Line Content (UK) Type of Change/Request\"},{\"id\":360001227172,\"title\":\"Country\"},{\"id\":360001124011,\"title\":\"2nd Line CTT Type of Change/Request\"},{\"id\":360001227992,\"title\":\"Phone Number - Only from form submission\"}],\"clientCustomerIds\":[\"8670301477\"],\"reports\":[\"PLACEHOLDER_REPORT_Normal\",\"PLACEMENT_PERFORMANCE_REPORT_Normal\",\"PRODUCT_PARTITION_REPORT_Normal\",\"SEARCH_QUERY_PERFORMANCE_REPORT_Normal\",\"SHOPPING_PERFORMANCE_REPORT_ConversionSegmented\",\"SHOPPING_PERFORMANCE_REPORT_Normal\",\"TOP_CONTENT_PERFORMANCE_REPORT_Normal\",\"URL_PERFORMANCE_REPORT_ConversionSegmented\",\"URL_PERFORMANCE_REPORT_Normal\",\"USER_AD_DISTANCE_REPORT_Normal\",\"VIDEO_PERFORMANCE_REPORT_ConversionSegmented\",\"VIDEO_PERFORMANCE_REPORT_Normal\"]},\"to\":[],\"oauthAccessTokenSecret\":\"oLZCb0LjGWAmmTONV8ciiz9f6ng488dncQps2h1eo2s2D\"}","extractor":null}}
