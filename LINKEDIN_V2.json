{"processDefinition":{"name":"linkedin-visitor-demographics","steps":[{"type":"LinkedInV2","name":"get_managed_companies","properties":{"url":"https://api.linkedin.com/v2/organizationAcls?q=roleAssignee","params":{"count":100}},"outputs":[{"name":"success","destination":"get_overal_page_stats","condition":"@{item.attributes.state == 'APPROVED'}"}],"itemAttributes":{"organizationId":"@{LINKEDIN.parseURN(evalJson(item, '$.organization'))}","companyUrn":"@{evalJson(item, '$.organization')}","state":"@{evalJson(item, '$.state')}"},"extendsStep":null},{"type":"LinkedInV2","name":"get_overal_page_stats","properties":{"url":"https://api.linkedin.com/v2/organizationPageStatistics","params":{"q":"organization","organization":"@{item.attributes.companyUrn}","count":200}},"outputs":[{"name":"success","destination":"select_seniorities","condition":null},{"name":"success","destination":"select_countries","condition":null},{"name":"success","destination":"select_industries","condition":null},{"name":"success","destination":"select_company_size","condition":null},{"name":"success","destination":"select_region","condition":null},{"name":"success","destination":"select_function","condition":null}],"itemAttributes":{"statsItem":"@{item.content}"},"extendsStep":null},{"type":"DbSelect","name":"select_function","properties":{"tableName":"FollowerFunction","distinctOn":["function"],"predicates":[{"field":"extraction_date","operator":"between","start":"@{now().toLocalDate().atStartOfDay()}","end":"@{now().plusDays(1).toLocalDate().atStartOfDay().minusSeconds(1)}"},{"field":"companyId","value":"@{item.attributes.organizationId}"}],"batchSize":0},"outputs":[{"name":"success","destination":"split_function","condition":null}],"itemAttributes":{"functionsJson":"@{toJson(item.content)}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_function","properties":{"array":"@{evalJson(item.attributes.statsItem, '$.pageStatisticsByFunction')}"},"outputs":[{"name":"success","destination":"map_function","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_function","properties":{"mappings":{"pageViews":"@{evalJson(item, '$.pageStatistics.views.allPageViews.pageViews')}","function":"@{LINKEDIN.parseURN(evalJson(item, '$.function'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"update_function","condition":"@{!evalJson(item.attributes.functionsJson, '$[?(@.function==\\''+ item.content.function + '\\')].function').isEmpty}"},{"name":"success","destination":"save_function","condition":"@{evalJson(item.attributes.functionsJson, '$[?(@.function==\\''+ item.content.function + '\\')].function').isEmpty}"}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_function","properties":{"tableName":"FollowerFunction","batchSize":400},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"UpdateFromMap","name":"update_function","properties":{"tableName":"FollowerFunction","batchSize":1000,"fields":["pageViews"],"predicates":[{"field":"function","value":"@{item.content.function}","operator":"="},{"field":"companyId","value":"@{item.attributes.organizationId}","operator":"="},{"field":"extraction_date","value":"@{item.content.extraction_date}","operator":"="}]},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"DbSelect","name":"select_region","properties":{"tableName":"FollowerRegion","distinctOn":["region"],"predicates":[{"field":"extraction_date","operator":"between","start":"@{now().toLocalDate().atStartOfDay()}","end":"@{now().plusDays(1).toLocalDate().atStartOfDay().minusSeconds(1)}"},{"field":"companyId","value":"@{item.attributes.organizationId}"}],"batchSize":0},"outputs":[{"name":"success","destination":"split_region","condition":null}],"itemAttributes":{"regionsJson":"@{toJson(item.content)}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_region","properties":{"array":"@{evalJson(item.attributes.statsItem, '$.pageStatisticsByRegion')}"},"outputs":[{"name":"success","destination":"map_region","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_region","properties":{"mappings":{"pageViews":"@{evalJson(item, '$.pageStatistics.views.allPageViews.pageViews')}","region":"@{LINKEDIN.parseURN(evalJson(item, '$.region'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"update_region","condition":"@{!evalJson(item.attributes.regionsJson, '$[?(@.region==\\''+ item.content.region + '\\')].region').isEmpty}"},{"name":"success","destination":"save_region","condition":"@{evalJson(item.attributes.regionsJson, '$[?(@.region==\\''+ item.content.region + '\\')].region').isEmpty}"}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_region","properties":{"tableName":"FollowerRegion","batchSize":400},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"UpdateFromMap","name":"update_region","properties":{"tableName":"FollowerRegion","batchSize":1000,"fields":["pageViews"],"predicates":[{"field":"region","value":"@{item.content.region}","operator":"="},{"field":"companyId","value":"@{item.attributes.organizationId}","operator":"="},{"field":"extraction_date","value":"@{item.content.extraction_date}","operator":"="}]},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"DbSelect","name":"select_company_size","properties":{"tableName":"FollowerCompanySize","distinctOn":["companySize"],"predicates":[{"field":"extraction_date","operator":"between","start":"@{now().toLocalDate().atStartOfDay()}","end":"@{now().plusDays(1).toLocalDate().atStartOfDay().minusSeconds(1)}"},{"field":"companyId","value":"@{item.attributes.organizationId}"}],"batchSize":0},"outputs":[{"name":"success","destination":"split_company_sizes","condition":null}],"itemAttributes":{"companySizesJson":"@{toJson(item.content)}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_company_sizes","properties":{"array":"@{evalJson(item.attributes.statsItem, '$.pageStatisticsByStaffCountRange')}"},"outputs":[{"name":"success","destination":"map_company_sizes","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_company_sizes","properties":{"mappings":{"pageViews":"@{evalJson(item, '$.pageStatistics.views.allPageViews.pageViews')}","companySize":"@{StringUtils.replace(capitalizeFully(evalJson(item, '$.staffCountRange'), '_'), '_', ' ').replace('Size ', '')}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"update_company_sizes","condition":"@{!evalJson(item.attributes.companySizesJson, '$[?(@.companySize==\\''+ item.content.companySize + '\\')].companySize').isEmpty}"},{"name":"success","destination":"save_company_size","condition":"@{evalJson(item.attributes.companySizesJson, '$[?(@.companySize==\\''+ item.content.companySize + '\\')].companySize').isEmpty}"}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_company_size","properties":{"tableName":"FollowerCompanySize","batchSize":400},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"UpdateFromMap","name":"update_company_sizes","properties":{"tableName":"FollowerCompanySize","batchSize":1000,"fields":["pageViews"],"predicates":[{"field":"companySize","value":"@{item.content.companySize}","operator":"="},{"field":"companyId","value":"@{item.attributes.organizationId}","operator":"="},{"field":"extraction_date","value":"@{item.content.extraction_date}","operator":"="}]},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"DbSelect","name":"select_industries","properties":{"tableName":"FollowerIndustries","distinctOn":["industry"],"predicates":[{"field":"extraction_date","operator":"between","start":"@{now().toLocalDate().atStartOfDay()}","end":"@{now().plusDays(1).toLocalDate().atStartOfDay().minusSeconds(1)}"},{"field":"companyId","value":"@{item.attributes.organizationId}"}],"batchSize":0},"outputs":[{"name":"success","destination":"split_industries","condition":null}],"itemAttributes":{"industriesJson":"@{toJson(item.content)}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_industries","properties":{"array":"@{evalJson(item.attributes.statsItem, '$.pageStatisticsByIndustry')}"},"outputs":[{"name":"success","destination":"map_industries","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_industries","properties":{"mappings":{"pageViews":"@{evalJson(item, '$.pageStatistics.views.allPageViews.pageViews')}","industry":"@{LINKEDIN.parseURN(evalJson(item, '$.industry'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"update_indeustries","condition":"@{!evalJson(item.attributes.industriesJson, '$[?(@.industry==\\''+ item.content.industry + '\\')].industry').isEmpty}"},{"name":"success","destination":"save_industries","condition":"@{evalJson(item.attributes.industriesJson, '$[?(@.industry==\\''+ item.content.industry + '\\')].industry').isEmpty}"}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_industries","properties":{"tableName":"FollowerIndustries","batchSize":400},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"UpdateFromMap","name":"update_indeustries","properties":{"tableName":"FollowerIndustries","batchSize":1000,"fields":["pageViews"],"predicates":[{"field":"industry","value":"@{item.content.industry}","operator":"="},{"field":"companyId","value":"@{item.attributes.organizationId}","operator":"="},{"field":"extraction_date","value":"@{item.content.extraction_date}","operator":"="}]},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"DbSelect","name":"select_countries","properties":{"tableName":"FollowerCountry","distinctOn":["countryCode"],"predicates":[{"field":"extraction_date","operator":"between","start":"@{now().toLocalDate().atStartOfDay()}","end":"@{now().plusDays(1).toLocalDate().atStartOfDay().minusSeconds(1)}"},{"field":"companyId","value":"@{item.attributes.organizationId}"}],"batchSize":0},"outputs":[{"name":"success","destination":"split_countries","condition":null}],"itemAttributes":{"countriesJson":"@{toJson(item.content)}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_countries","properties":{"array":"@{evalJson(item.attributes.statsItem, '$.pageStatisticsByCountry')}"},"outputs":[{"name":"success","destination":"map_country","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_country","properties":{"mappings":{"pageViews":"@{evalJson(item, '$.pageStatistics.views.allPageViews.pageViews')}","countryCode":"@{LINKEDIN.parseURN(evalJson(item, '$.country'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"update_countries","condition":"@{!evalJson(item.attributes.countriesJson, '$[?(@.countryCode==\\''+ item.content.countryCode + '\\')].countryCode').isEmpty}"},{"name":"success","destination":"save_countries","condition":"@{evalJson(item.attributes.countriesJson, '$[?(@.countryCode==\\''+ item.content.countryCode + '\\')].countryCode').isEmpty}"}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_countries","properties":{"tableName":"FollowerCountry","batchSize":400},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"UpdateFromMap","name":"update_countries","properties":{"tableName":"FollowerCountry","batchSize":1000,"fields":["pageViews"],"predicates":[{"field":"countryCode","value":"@{item.content.countryCode}","operator":"="},{"field":"companyId","value":"@{item.attributes.organizationId}","operator":"="},{"field":"extraction_date","value":"@{item.content.extraction_date}","operator":"="}]},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"DbSelect","name":"select_seniorities","properties":{"tableName":"FollowerSeniority","distinctOn":["seniority"],"predicates":[{"field":"extraction_date","operator":"between","start":"@{now().toLocalDate().atStartOfDay()}","end":"@{now().plusDays(1).toLocalDate().atStartOfDay().minusSeconds(1)}"},{"field":"companyId","value":"@{item.attributes.organizationId}"}],"batchSize":0},"outputs":[{"name":"success","destination":"split_seniorities","condition":null}],"itemAttributes":{"senioritiesJson":"@{toJson(item.content)}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_seniorities","properties":{"array":"@{evalJson(item.attributes.statsItem, '$.pageStatisticsBySeniority')}"},"outputs":[{"name":"success","destination":"map_seniority_stats","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_seniority_stats","properties":{"mappings":{"pageViews":"@{evalJson(item, '$.pageStatistics.views.allPageViews.pageViews')}","seniority":"@{LINKEDIN.parseURN(evalJson(item, '$.seniority'))}","extraction_date":"@{currentDate().atStartOfDay()}","companyId":"@{item.attributes.organizationId}"}},"outputs":[{"name":"success","destination":"update_seniority","condition":"@{!evalJson(item.attributes.senioritiesJson, '$[?(@.seniority==\\''+ item.content.seniority + '\\')].seniority').isEmpty}"},{"name":"success","destination":"save_seniority","condition":"@{evalJson(item.attributes.senioritiesJson, '$[?(@.seniority==\\''+ item.content.seniority + '\\')].seniority').isEmpty}"}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_seniority","properties":{"tableName":"FollowerSeniority","batchSize":400},"outputs":null,"itemAttributes":{},"extendsStep":null},{"type":"UpdateFromMap","name":"update_seniority","properties":{"tableName":"FollowerSeniority","batchSize":1000,"fields":["pageViews"],"predicates":[{"field":"seniority","value":"@{item.content.seniority}","operator":"="},{"field":"companyId","value":"@{item.attributes.organizationId}","operator":"="},{"field":"extraction_date","value":"@{item.content.extraction_date}","operator":"="}]},"outputs":null,"itemAttributes":{},"extendsStep":null}],"excludes":[],"generalSteps":[],"dependencies":["linked-in-v2"],"ignoreExceptionTypes":null,"exceptionIgnoreExpression":null},"extractor":{"id":0,"publicId":null,"lastExecution":null,"startExecution":null,"finishExecution":null,"queuedExecution":null,"nextExecution":null,"timeUnit":null,"timePeriod":0,"active":false,"status":null,"errorType":null,"message":null,"errorCounter":0,"fullExtraction":true},"connectorCredentials":{"id":0,"organizationId":35,"datasourceId":35369,"connectorType":"LINKEDIN","creationDate":null,"refreshToken":"AQWo8De_V-oFFdFO2GpSOWWJw_CvTbV2Ggm-v3qDe5WfYlukPhTdbf5Sqs1GrYlfKA_IoZdtAAnpz3RAMSDZ5xcmDJfAxGVEAejz779k14_dUEWQ_xfSoDRJ-R6bj_kOnbk9Pc7m40NyxvAFogolqhQ4R49LiGCIRKDK5GZCTlXikEN1qBqnpHvRVqoNp0Xdrb4Fc8YIiqYOdxSQqPQLPopsf9NvVj3JbJgb79g-MeCDPVPyo3MtOSONUbaQtE6lzdfCRBKK7Uh4f9X5o3EUW2ElYor4pxXrkezaMyCZncxzFHI6zfzdBSgbrtiOn3UqgmAHqrLaXTz6CenQXPYgzW1R3E_S9g","datamart":"localhost","config":"{\"properties\":{\"pageId\":\"100230508074773910534\",\"domain\":\"mettrr\",\"customFields\":[{\"id\":360001124611,\"title\":\"3rd Line Tech Support (UK) Type of Change/Request\"},{\"id\":360001486852,\"title\":\"3rd Line Adwords management Type of Change/Request\"},{\"id\":360001486872,\"title\":\"3rd Line Product support Type of Change/Request\"},{\"id\":360001063512,\"title\":\"2nd Line Legacy CWT Type of Change/Request\"},{\"id\":360002165852,\"title\":\"Mark as Spam\"},{\"id\":360001063532,\"title\":\"3rd Line Accounts and Admin (UK) Type of Change/Request\"},{\"id\":360001062512,\"title\":\"2nd Line CWT Type of Change/Request\"},{\"id\":360001123991,\"title\":\"1st Line Type of Change/Request\"},{\"id\":360001124771,\"title\":\"3rd Line Content (UK) Type of Change/Request\"},{\"id\":360001227172,\"title\":\"Country\"},{\"id\":360001124011,\"title\":\"2nd Line CTT Type of Change/Request\"},{\"id\":360001227992,\"title\":\"Phone Number - Only from form submission\"}],\"clientCustomerIds\":[\"8670301477\"],\"reports\":[\"PLACEHOLDER_REPORT_Normal\",\"PLACEMENT_PERFORMANCE_REPORT_Normal\",\"PRODUCT_PARTITION_REPORT_Normal\",\"SEARCH_QUERY_PERFORMANCE_REPORT_Normal\",\"SHOPPING_PERFORMANCE_REPORT_ConversionSegmented\",\"SHOPPING_PERFORMANCE_REPORT_Normal\",\"TOP_CONTENT_PERFORMANCE_REPORT_Normal\",\"URL_PERFORMANCE_REPORT_ConversionSegmented\",\"URL_PERFORMANCE_REPORT_Normal\",\"USER_AD_DISTANCE_REPORT_Normal\",\"VIDEO_PERFORMANCE_REPORT_ConversionSegmented\",\"VIDEO_PERFORMANCE_REPORT_Normal\"]},\"to\":[],\"oauthAccessTokenSecret\":\"oLZCb0LjGWAmmTONV8ciiz9f6ng488dncQps2h1eo2s2D\"}","extractor":null}}