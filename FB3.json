{"processDefinition":{"name":"marketing-general","steps":[{"type":"FacebookMarketing","name":"get_ads_accounts","properties":{"url":"me/adaccounts","isSingleObject":false,"fields":["id","name"]},"outputs":[{"name":"success","destination":"get_account_related_data","condition":null},{"name":"success","destination":"get_archived","condition":null}],"itemAttributes":{"accountId":"@{evalJson(item, '$.id')}"},"extendsStep":null},{"type":"DeleteFromDB","name":"clean_tables","properties":{"tables":["ad","ad_set","campaign","account"]},"outputs":[{"name":"success","destination":"get_ads_accounts","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"FacebookMarketing","name":"get_archived","properties":{"batchRequests":{"Campaigns":{"url":"@{item.attributes.accountId}/campaigns","isSingleObject":false,"parameters":{"limit":500,"effective_status":"[\"ARCHIVED\"]"},"fields":["id","name","objective","account_id","start_time","effective_status","created_time"]},"AdSets":{"url":"@{item.attributes.accountId}/adsets","isSingleObject":false,"parameters":{"limit":500,"effective_status":"[\"ARCHIVED\"]"},"fields":["id","name","campaign_id","end_time","start_time","daily_budget","created_time","lifetime_budget","effective_status"]},"Ads":{"url":"@{item.attributes.accountId}/ads","isSingleObject":false,"parameters":{"limit":500,"effective_status":"[\"ARCHIVED\"]"},"fields":["id","name","adset_id","effective_status","created_time","updated_time"]}}},"outputs":[{"name":"success","destination":"split_campaigns","condition":"@{item.attributes.requestName  == 'Campaigns'}"},{"name":"success","destination":"split_ads","condition":"@{item.attributes.requestName  == 'Ads'}"},{"name":"success","destination":"split_ad_sets","condition":"@{item.attributes.requestName  == 'AdSets'}"}],"itemAttributes":{"requestName":"@{evalJson(item, '$.requestName')}"},"extendsStep":null},{"type":"FacebookMarketing","name":"get_account_related_data","properties":{"batchRequests":{"Account":{"url":"@{item.attributes.accountId}","isSingleObject":true,"fields":["id","name","created_time"]},"Campaigns":{"url":"@{item.attributes.accountId}/campaigns","isSingleObject":false,"parameters":{"limit":500},"fields":["id","name","objective","account_id","start_time","end_time","effective_status","created_time"]},"AdSets":{"url":"@{item.attributes.accountId}/adsets","isSingleObject":false,"parameters":{"limit":500},"fields":["id","name","campaign_id","end_time","start_time","daily_budget","created_time","lifetime_budget","effective_status"]},"Ads":{"url":"@{item.attributes.accountId}/ads","isSingleObject":false,"parameters":{"limit":500},"fields":["id","name","adset_id","effective_status","created_time","updated_time"]}}},"outputs":[{"name":"success","destination":"map_account","condition":"@{item.attributes.requestName  == 'Account'}"},{"name":"success","destination":"split_campaigns","condition":"@{item.attributes.requestName  == 'Campaigns'}"},{"name":"success","destination":"split_ad_sets","condition":"@{item.attributes.requestName  == 'AdSets'}"},{"name":"success","destination":"split_ads","condition":"@{item.attributes.requestName  == 'Ads'}"}],"itemAttributes":{"requestName":"@{evalJson(item, '$.requestName')}"},"extendsStep":null},{"type":"SplitJsonArray","name":"split_ads","properties":{"array":"@{evalJson(item, '$.data')}"},"outputs":[{"name":"success","destination":"map_ads","condition":"@{toDateTime(evalJson(item, '$.created_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').isAfter(toDate('2015-01-01', 'yyyy-MM-dd').atStartOfDay())}"}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_ads","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","name":"@{evalJson(item, '$.name')}","adgroup_status":"@{evalJson(item, '$.effective_status')}","ad_set_id":"@{evalJson(item, '$.adset_id')}","updated_time":"@{toDateTime(evalJson(item, '$.updated_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ')}"}},"outputs":[{"name":"success","destination":"save_ads","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_ads","properties":{"tableName":"ad","batchSize":400},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_ad_sets","properties":{"array":"@{evalJson(item, '$.data')}"},"outputs":[{"name":"success","destination":"map_ad_sets","condition":"@{toDateTime(evalJson(item, '$.created_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').isAfter(toDate('2015-01-01', 'yyyy-MM-dd').atStartOfDay())}"}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_ad_sets","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","name":"@{evalJson(item, '$.name')}","campaign_id":"@{evalJson(item, '$.campaign_id')}","daily_budget":"@{evalJson(item, '$.daily_budget')}","lifetime_budget":"@{evalJson(item, '$.lifetime_budget')}","start_time":"@{toDateTime(evalJson(item, '$.start_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ')}","end_time":"@{toDateTime(evalJson(item, '$.end_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ')}"}},"outputs":[{"name":"success","destination":"save_ad_sets","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_ad_sets","properties":{"tableName":"ad_set","batchSize":400},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"SplitJsonArray","name":"split_campaigns","properties":{"array":"@{evalJson(item, '$.data')}"},"outputs":[{"name":"success","destination":"map_campaigns","condition":"@{toDateTime(evalJson(item, '$.created_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ').isAfter(toDate('2015-01-01', 'yyyy-MM-dd').atStartOfDay())}"}],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_campaigns","properties":{"mappings":{"id":"@{evalJson(item, '$.id')}","name":"@{evalJson(item, '$.name')}","objective":"@{evalJson(item, '$.objective')}","account_id":"act_@{evalJson(item, '$.account_id')}","campaign_group_status":"@{evalJson(item, '$.effective_status')}","start_time":"@{toDateTime(evalJson(item, '$.start_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ')}","end_time":"@{toDateTime(evalJson(item, '$.end_time'), 'yyyy-MM-dd\\'T\\'HH:mm:ssZ')}"}},"outputs":[{"name":"success","destination":"save_campaigns","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_campaigns","properties":{"tableName":"campaign","batchSize":400},"outputs":[],"itemAttributes":{},"extendsStep":null},{"type":"ToMap","name":"map_account","properties":{"mappings":{"id":"@{evalJson(item, '$.data.id')}","name":"@{evalJson(item, '$.data.name')}"}},"outputs":[{"name":"success","destination":"save_account","condition":null}],"itemAttributes":{},"extendsStep":null},{"type":"InsertMapIntoDB","name":"save_account","properties":{"tableName":"account","batchSize":400},"outputs":null,"itemAttributes":{},"extendsStep":null}],"excludes":[],"generalSteps":[],"dependencies":null,"ignoreExceptionTypes":null,"exceptionIgnoreExpression":null},"extractor":{"id":0,"publicId":null,"lastExecution":null,"startExecution":null,"finishExecution":null,"queuedExecution":null,"timeUnit":null,"timePeriod":0,"active":false,"status":null,"message":null,"errorCounter":0,"fullExtraction":true},"connectorCredentials":{"id":0,"organizationId":38,"datasourceId":1023896,"connectorType":null,"creationDate":null,"refreshToken":"EAAGuoVILSX4BABrwgGpCfYZBDXybShMM89BXZBCWspYDfDwIXu1NQUH5hAlKQ5ZALpVnvrStOIRWz0FqqRB4MreonlxmJ27NABGN7ev1tDz9qA8LuB7IEuQF2d2oxnZCYhao8IBZAJWvrG9l07N7mkcxaN7YBtGfsqtmJugsLLtvSFnOTb6Io","datamart":"localhost","config":"{\"properties\":{\"pageId\":\"+ExoplatformTribe\",\"domain\":\"mettrr\",\"customFields\":[{\"id\":360001124611,\"title\":\"3rd Line Tech Support (UK) Type of Change/Request\"},{\"id\":360001486852,\"title\":\"3rd Line Adwords management Type of Change/Request\"},{\"id\":360001486872,\"title\":\"3rd Line Product support Type of Change/Request\"},{\"id\":360001063512,\"title\":\"2nd Line Legacy CWT Type of Change/Request\"},{\"id\":360002165852,\"title\":\"Mark as Spam\"},{\"id\":360001063532,\"title\":\"3rd Line Accounts and Admin (UK) Type of Change/Request\"},{\"id\":360001062512,\"title\":\"2nd Line CWT Type of Change/Request\"},{\"id\":360001123991,\"title\":\"1st Line Type of Change/Request\"},{\"id\":360001124771,\"title\":\"3rd Line Content (UK) Type of Change/Request\"},{\"id\":360001227172,\"title\":\"Country\"},{\"id\":360001124011,\"title\":\"2nd Line CTT Type of Change/Request\"},{\"id\":360001227992,\"title\":\"Phone Number - Only from form submission\"}],\"clientCustomerIds\":[\"8049594734\"],\"reports\":[\"ACCOUNT_PERFORMANCE_REPORT_Normal\"]},\"to\":[],\"oauthAccessTokenSecret\":\"oLZCb0LjGWAmmTONV8ciiz9f6ng488dncQps2h1eo2s2D\"}","extractor":null}}